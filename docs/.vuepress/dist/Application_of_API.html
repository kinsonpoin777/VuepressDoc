<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OPEN API Doc</title>
    <meta name="description" content="接口说明文档">
    <link rel="icon" href="/bitbug_favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.584498ef.css" as="style"><link rel="preload" href="/assets/js/app.db21f27a.js" as="script"><link rel="preload" href="/assets/js/2.82b08f5a.js" as="script"><link rel="preload" href="/assets/js/7.04069a34.js" as="script"><link rel="prefetch" href="/assets/js/10.22aa21c7.js"><link rel="prefetch" href="/assets/js/11.2b479cd9.js"><link rel="prefetch" href="/assets/js/12.d0a30bd4.js"><link rel="prefetch" href="/assets/js/13.e1c32ab9.js"><link rel="prefetch" href="/assets/js/14.a358029f.js"><link rel="prefetch" href="/assets/js/15.b95dcb64.js"><link rel="prefetch" href="/assets/js/3.69a9e6aa.js"><link rel="prefetch" href="/assets/js/4.2a9a9e3e.js"><link rel="prefetch" href="/assets/js/5.ddaaa47b.js"><link rel="prefetch" href="/assets/js/6.898b7d41.js"><link rel="prefetch" href="/assets/js/8.13be9294.js"><link rel="prefetch" href="/assets/js/9.4b85b1ac.js">
    <link rel="stylesheet" href="/assets/css/0.styles.584498ef.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">OPEN API Doc</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/Guide.html" class="sidebar-link">接入指南</a></li><li><a href="/IOT.html" class="sidebar-link">IOT通讯协议</a></li><li><a href="/Application_of_API.html" class="active sidebar-link">应用API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Application_of_API.html#_1-api概述" class="sidebar-link">1. API概述</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_2-使用流程" class="sidebar-link">2. 使用流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Application_of_API.html#_2-1-成为开发者" class="sidebar-link">2.1 成为开发者</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_2-2-创建应用" class="sidebar-link">2.2 创建应用</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_2-3-获取密钥" class="sidebar-link">2.3 获取密钥</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_2-4-生成签名" class="sidebar-link">2.4 生成签名</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_2-5-开始开发" class="sidebar-link">2.5 开始开发</a></li></ul></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_3-调用方式" class="sidebar-link">3. 调用方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Application_of_API.html#_3-1-服务地址" class="sidebar-link">3.1 服务地址</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_3-2-通信协议" class="sidebar-link">3.2 通信协议</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_3-3-请求方法" class="sidebar-link">3.3 请求方法</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_3-4-字符编码" class="sidebar-link">3.4 字符编码</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_3-5-公共参数" class="sidebar-link">3.5 公共参数</a></li></ul></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_4-签名机制" class="sidebar-link">4. 签名机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Application_of_API.html#_4-1-签名机制简介" class="sidebar-link">4.1 签名机制简介</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_4-2-获取应用密钥" class="sidebar-link">4.2 获取应用密钥</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_4-3-签名生成样例" class="sidebar-link">4.3 签名生成样例</a></li></ul></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_5-接口鉴权" class="sidebar-link">5. 接口鉴权</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Application_of_API.html#_5-1-使用用户信息登录（邮箱-qq-微信账号登录）" class="sidebar-link">5.1 使用用户信息登录（邮箱/QQ/微信账号登录）</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_5-2-使用后台方式登录" class="sidebar-link">5.2 使用后台方式登录</a></li></ul></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_6-设备管理" class="sidebar-link">6. 设备管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Application_of_API.html#_6-1-获取设备列表" class="sidebar-link">6.1 获取设备列表</a></li></ul></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_7-服务管理" class="sidebar-link">7. 服务管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Application_of_API.html#_7-1-调用第三方服务" class="sidebar-link">7.1 调用第三方服务</a></li></ul></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_8-帐号权限" class="sidebar-link">8. 帐号权限</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Application_of_API.html#_8-1-获取当前用户信息" class="sidebar-link">8.1 获取当前用户信息</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_8-2-新增角色" class="sidebar-link">8.2 新增角色</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_8-3-删除角色" class="sidebar-link">8.3 删除角色</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_8-4-查询角色" class="sidebar-link">8.4 查询角色</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_8-5-新增角色与设备关系" class="sidebar-link">8.5 新增角色与设备关系</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_8-6-删除角色与设备关系" class="sidebar-link">8.6 删除角色与设备关系</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_8-7-查询角色与设备关系" class="sidebar-link">8.7 查询角色与设备关系</a></li></ul></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_9-消息广播" class="sidebar-link">9. 消息广播</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Application_of_API.html#_9-1-发送消息到设备" class="sidebar-link">9.1 发送消息到设备</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_9-2-智能设备控制" class="sidebar-link">9.2 智能设备控制</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_9-3-获取文件上传" class="sidebar-link">9.3 获取文件上传</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_9-4-通知平台文件已上传" class="sidebar-link">9.4 通知平台文件已上传</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_9-5-消息推送接口" class="sidebar-link">9.5 消息推送接口</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_9-6-应用接收消息格式（来源应用）" class="sidebar-link">9.6 应用接收消息格式（来源应用）</a></li><li class="sidebar-sub-header"><a href="/Application_of_API.html#_9-7-应用接收消息格式（来源设备）" class="sidebar-link">9.7 应用接收消息格式（来源设备）</a></li></ul></li></ul></li><li><a href="/Video_service.html" class="sidebar-link">视频服务</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数字空间</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/Error_code.html" class="sidebar-link">错误码</a></li><li><a href="/appendix.html" class="sidebar-link">附录</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>[TOC]</p> <h1 id="微瓴应用api"><a href="#微瓴应用api" aria-hidden="true" class="header-anchor">#</a> 微瓴应用API</h1> <h2 id="_1-api概述"><a href="#_1-api概述" aria-hidden="true" class="header-anchor">#</a> 1. API概述</h2> <p>Hi，您好，欢迎使用腾讯微瓴开放平台服务。
本文档主要介绍腾讯微瓴开放平台API快速使用流程，如果您对文档内容有任何疑问，可以通过以下方式联系我们：    联系邮箱：<code>welink@tencent.com</code></p> <hr> <h2 id="_2-使用流程"><a href="#_2-使用流程" aria-hidden="true" class="header-anchor">#</a> 2. 使用流程</h2> <h3 id="_2-1-成为开发者"><a href="#_2-1-成为开发者" aria-hidden="true" class="header-anchor">#</a> 2.1 成为开发者</h3> <p><a href="https://open.welink.qq.com/#/dev-resource/guide/qualification" target="_blank" rel="noopener noreferrer">https://open.welink.qq.com/#/dev-resource/guide/qualification<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
点击顶部导航栏右侧控制台或者底部快速入门-管理控制台，首次登录将会跳转到注册界面，完成企业资质注册即可进入控制台页面。</p> <h3 id="_2-2-创建应用"><a href="#_2-2-创建应用" aria-hidden="true" class="header-anchor">#</a> 2.2 创建应用</h3> <p>在控制台页面，您可以在【应用管理】板块点击新增应用，填写应用的相关信息，自动生成应用AppID、AppKey和应用票据[将后台审核描述去掉，更改为“自动生成应用AppID、AppKey和应用票据”]，完成应用的创建。</p> <h3 id="_2-3-获取密钥"><a href="#_2-3-获取密钥" aria-hidden="true" class="header-anchor">#</a> 2.3 获取密钥</h3> <p>在您的应用创建成功之后，可以在应用调试或应用详情中查看此应用的接入凭证AppID和AppKey。这是您的应用接入微瓴的主要凭证，每个应用有唯一标识，互不相同，请您妥善保管。</p> <h3 id="_2-4-生成签名"><a href="#_2-4-生成签名" aria-hidden="true" class="header-anchor">#</a> 2.4 生成签名</h3> <p>您的应用在调用微瓴API之前，首先需要获取接口鉴权的签名。您需要使用应用所分配的AppID和AppKey，参考签名Demo，生成API接口鉴权签名。</p> <h3 id="_2-5-开始开发"><a href="#_2-5-开始开发" aria-hidden="true" class="header-anchor">#</a> 2.5 开始开发</h3> <p>腾讯微瓴开放了REST API形式的服务，您可以点击【开发资源-API文档】查看具体调用参数及方法。</p> <hr> <h2 id="_3-调用方式"><a href="#_3-调用方式" aria-hidden="true" class="header-anchor">#</a> 3. 调用方式</h2> <h3 id="_3-1-服务地址"><a href="#_3-1-服务地址" aria-hidden="true" class="header-anchor">#</a> 3.1 服务地址</h3> <p>本文档列举了微瓴开放平台可提供的全部 API 功能，但是在具体项目中，对接使用的 API 接口应该是 API 文档中的部分接口，开发者可以查看平台可使用的API 接口列表，通过指定域名访问，在实际项目对应的环境中进行联调。</p> <ul><li>目前支持的环境和域名列表为：</li></ul> <table><thead><tr><th style="text-align:center;">接入地域</th> <th style="text-align:center;">环境类别</th> <th style="text-align:center;">域名</th></tr></thead> <tbody><tr><td style="text-align:center;">西南地区（重庆）</td> <td style="text-align:center;">开放平台沙箱环境</td> <td style="text-align:center;">sandboxapi.welink.qq.com</td></tr> <tr><td style="text-align:center;">西南地区（重庆）</td> <td style="text-align:center;">公有云环境</td> <td style="text-align:center;">openapi.weiling.qq.com/chongqin</td></tr> <tr><td style="text-align:center;">华南地区（广州）</td> <td style="text-align:center;">公有云环境</td> <td style="text-align:center;">api-gz.welink.qq.com</td></tr></tbody></table> <h3 id="_3-2-通信协议"><a href="#_3-2-通信协议" aria-hidden="true" class="header-anchor">#</a> 3.2 通信协议</h3> <p>微瓴开放平台提供的所有API接口均通过HTTPS协议传输，提供高安全性的通讯。</p> <h3 id="_3-3-请求方法"><a href="#_3-3-请求方法" aria-hidden="true" class="header-anchor">#</a> 3.3 请求方法</h3> <p>微瓴支持的 HTTP 请求方法:</p> <ul><li>POST（推荐）</li> <li>GET</li></ul> <p>POST 请求支持的 Content-Type 类型：</p> <ul><li>application/json（推荐），必须使用 HMAC-SHA1 签名方法。</li> <li>GET 请求的请求包大小不得超过 32 KB。</li> <li>POST 请求使用签名方法为 HMAC-SHA1时不得超过 1 MB。</li></ul> <h3 id="_3-4-字符编码"><a href="#_3-4-字符编码" aria-hidden="true" class="header-anchor">#</a> 3.4 字符编码</h3> <ul><li>均使用UTF-8编码。</li></ul> <h3 id="_3-5-公共参数"><a href="#_3-5-公共参数" aria-hidden="true" class="header-anchor">#</a> 3.5 公共参数</h3> <ul><li>公共参数是用于标识接口鉴权的参数，每次请求均需要携带这些参数，才能正常发起请求</li></ul> <table><thead><tr><th style="text-align:center;">参数</th> <th style="text-align:center;">参数描述</th></tr></thead> <tbody><tr><td style="text-align:center;">appid</td> <td style="text-align:center;">应用接入微瓴的唯一标识App ID，新增应用通过后系统自动生成</td></tr> <tr><td style="text-align:center;">app_ticket</td> <td style="text-align:center;">用于登录API的应用票据，app_ticket有时间期限，由管理员决定app_ticket的期限，推荐3个月，请注意及时更新票据</td></tr> <tr><td style="text-align:center;">sig</td> <td style="text-align:center;">加密的密文，用于登录API使用，生成方式见生成签名</td></tr> <tr><td style="text-align:center;">token</td> <td style="text-align:center;">动态密钥，20分钟有效期，每一次调用API均需要带上该密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">物联票据，每一次调用API均需要带上该票据</td></tr></tbody></table> <hr> <h2 id="_4-签名机制"><a href="#_4-签名机制" aria-hidden="true" class="header-anchor">#</a> 4. 签名机制</h2> <h3 id="_4-1-签名机制简介"><a href="#_4-1-签名机制简介" aria-hidden="true" class="header-anchor">#</a> 4.1 签名机制简介</h3> <p>微瓴开放平台HTTP API使用签名机制来验证请求的合法性。应用在调用微瓴API时必须带上接口请求签名，其中签名信息由接口请求参数和应用密钥根据本文提供的HMAC-SHA1算法生成，使用Base64编码。对于校验不通过的请求，API将拒绝处理，并返回鉴权失败错误。</p> <h3 id="_4-2-获取应用密钥"><a href="#_4-2-获取应用密钥" aria-hidden="true" class="header-anchor">#</a> 4.2 获取应用密钥</h3> <p>登录微瓴开放平台，进入控制台-应用管理页面，如您未创建应用，可通过新增应用功能创建应用，获取AppID和AppKey。</p> <h3 id="_4-3-签名生成样例"><a href="#_4-3-签名生成样例" aria-hidden="true" class="header-anchor">#</a> 4.3 签名生成样例</h3> <p>获取到AppID和AppKey之后，您需要自行实现生成签名的功能。签名的生成推荐使用我们提供的各语言Demo。具体样例如下：</p> <h4 id="_4-3-1-java签名示例"><a href="#_4-3-1-java签名示例" aria-hidden="true" class="header-anchor">#</a> 4.3.1 JAVA签名示例</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token keyword">long</span> times<span class="token punctuation">,</span><span class="token keyword">long</span> num<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> k <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> t <span class="token operator">=</span> <span class="token function">getBytesByLong</span><span class="token punctuation">(</span>times<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> n <span class="token operator">=</span> <span class="token function">getBytesByLong</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> np <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>k<span class="token punctuation">.</span>length<span class="token operator">+</span>t<span class="token punctuation">.</span>length<span class="token operator">+</span>n<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>k<span class="token punctuation">.</span>length<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">,</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    np<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>k<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>t<span class="token punctuation">.</span>length<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">,</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    np<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>t<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>n<span class="token punctuation">.</span>length<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">,</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    np<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>n<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token class-name">String</span> sha1 <span class="token operator">=</span> <span class="token function">getSHA1</span><span class="token punctuation">(</span>np<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> sha1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getBytesByLong</span><span class="token punctuation">(</span><span class="token keyword">long</span> data<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  bytes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>data <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bytes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>data <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bytes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>data <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bytes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>data <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bytes<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>data <span class="token operator">&gt;&gt;</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bytes<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>data <span class="token operator">&gt;&gt;</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bytes<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>data <span class="token operator">&gt;&gt;</span> <span class="token number">48</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bytes<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>data <span class="token operator">&gt;&gt;</span> <span class="token number">56</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> bytes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getSHA1</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> sha1 <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">MessageDigest</span> digest <span class="token operator">=</span> <span class="token class-name">MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;SHA-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    digest<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messageDigest <span class="token operator">=</span> digest<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StringBuilder</span> hexString <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> messageDigest<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">String</span> shaHex <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>messageDigest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>shaHex<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          hexString<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        hexString<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>shaHex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    sha1 <span class="token operator">=</span> hexString<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> sha1<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h4 id="_4-3-2-python签名示例"><a href="#_4-3-2-python签名示例" aria-hidden="true" class="header-anchor">#</a> 4.3.2 Python签名示例</h4> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time
<span class="token keyword">import</span> struct
<span class="token keyword">import</span> hashlib

timestamp <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#timestamp = '1494502392528'</span>
nonceStr <span class="token operator">=</span> <span class="token string">'4561615'</span>
KEYS <span class="token operator">=</span> <span class="token string">'************'</span>
<span class="token comment">#12sqq 中的 12s 表示KEYS的长度为12</span>
signature_str <span class="token operator">=</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'=12sqq'</span><span class="token punctuation">,</span>KEYS<span class="token punctuation">,</span><span class="token builtin">long</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">long</span><span class="token punctuation">(</span>nonceStr<span class="token punctuation">)</span><span class="token punctuation">)</span>

signature <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span>signature_str<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_4-3-3-php签名示例"><a href="#_4-3-3-php签名示例" aria-hidden="true" class="header-anchor">#</a> 4.3.3 PHP签名示例</h4> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$key</span><span class="token operator">=</span><span class="token single-quoted-string string">'testtesttesttest1'</span><span class="token punctuation">;</span>
<span class="token variable">$times</span> <span class="token operator">=</span> <span class="token number">1479693497852</span><span class="token punctuation">;</span>
<span class="token variable">$num</span> <span class="token operator">=</span> <span class="token number">4516316</span><span class="token punctuation">;</span>

<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token variable">$times</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token variable">$times</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token variable">$k</span> <span class="token operator">=</span> <span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$t</span> <span class="token operator">=</span> <span class="token function">getBytesByLong</span><span class="token punctuation">(</span><span class="token variable">$times</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$n</span> <span class="token operator">=</span> <span class="token function">getBytesByLong</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$np</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$np</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$k</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$np</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$t</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$n</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$np</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$n</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//var_dump($np);</span>
  <span class="token variable">$sha1</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token function">toStr</span><span class="token punctuation">(</span><span class="token variable">$np</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token variable">$sha1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">toStr</span><span class="token punctuation">(</span><span class="token variable">$bytes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$bytes</span> <span class="token keyword">as</span> <span class="token variable">$ch</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$str</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* 转换一个String字符串为byte数组
* @param $str 需要转换的字符串
* @param $bytes 目标byte数组
* @author weling
*/</span>
<span class="token keyword">function</span> <span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$bytes</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$bytes</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token variable">$bytes</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* 转换一个long为byte数组
* @param $byt 目标byte数组
* @param $val 需要转换的字符串
*/</span>
<span class="token keyword">function</span> <span class="token function">getBytesBylong</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">PHP_INT_SIZE</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//整型为 32 位</span>
    <span class="token variable">$byt</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token number">8</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token number">16</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token number">24</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">&gt;</span> <span class="token constant">PHP_INT_MAX</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token variable">$high</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">/</span> <span class="token number">4294967296</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$high</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$high</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token number">8</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$high</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token number">16</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$high</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token number">24</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token variable">$byt</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token comment">//整型为 64 位</span>
    <span class="token variable">$byt</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token number">8</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token number">16</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token number">24</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token number">32</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token number">40</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token number">48</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$byt</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$val</span> <span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token number">56</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$byt</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div><h4 id="_4-3-4-nodejs签名示例"><a href="#_4-3-4-nodejs签名示例" aria-hidden="true" class="header-anchor">#</a> 4.3.4 NodeJS签名示例</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// if not browser env, then require node.js's util. otherwise just use window's</span>
<span class="token keyword">const</span> TextEncoder <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>TextEncoder <span class="token punctuation">:</span> window<span class="token punctuation">.</span>TextEncoder

<span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">encryptSig</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">appKey<span class="token punctuation">,</span> timeStamp<span class="token punctuation">,</span> randomNum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> keyBytes <span class="token operator">=</span> <span class="token function">getBytesByStr</span><span class="token punctuation">(</span>appKey<span class="token punctuation">)</span>
  <span class="token keyword">let</span> timestampBytes <span class="token operator">=</span> <span class="token function">getBytesByInt64LE</span><span class="token punctuation">(</span>timeStamp<span class="token punctuation">)</span>
  <span class="token keyword">let</span> numberBytes <span class="token operator">=</span> <span class="token function">getBytesByInt64LE</span><span class="token punctuation">(</span>randomNum<span class="token punctuation">)</span>
  <span class="token keyword">let</span> concatBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>keyBytes<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">)</span>
  concatBuffer<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>keyBytes<span class="token punctuation">)</span>
  concatBuffer<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>timestampBytes<span class="token punctuation">,</span> keyBytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  concatBuffer<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>numberBytes<span class="token punctuation">,</span> keyBytes<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> sha1 <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'SHA1'</span><span class="token punctuation">)</span>
  sha1<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>concatBuffer<span class="token punctuation">)</span>
  <span class="token keyword">let</span> sigResult <span class="token operator">=</span> sha1<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> sigResult
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">getBytesByStr</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// always utf-8</span>
  <span class="token keyword">let</span> encoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> strBuffer <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>appKey<span class="token punctuation">)</span>
  <span class="token keyword">return</span> strBuffer
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">getBytesByInt64LE</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> w <span class="token operator">=</span> <span class="token number">4294967296</span>
  <span class="token keyword">let</span> high <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>number <span class="token operator">/</span> w<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffffffff</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> low <span class="token operator">=</span> number <span class="token operator">%</span> w
  <span class="token comment">// transfer to LE</span>
  <span class="token keyword">let</span> numberLEArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
  numberLEArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> low <span class="token operator">&amp;</span> <span class="token number">0xff</span>
  numberLEArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> low <span class="token operator">&gt;&gt;</span> <span class="token number">8</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span>
  numberLEArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> low <span class="token operator">&gt;&gt;</span> <span class="token number">16</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span>
  numberLEArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> low <span class="token operator">&gt;&gt;</span> <span class="token number">24</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span>
  numberLEArray<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> high <span class="token operator">&amp;</span> <span class="token number">0xff</span>
  numberLEArray<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> high <span class="token operator">&gt;&gt;</span> <span class="token number">8</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span>
  numberLEArray<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> high <span class="token operator">&gt;&gt;</span> <span class="token number">16</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span>
  numberLEArray<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> high <span class="token operator">&gt;&gt;</span> <span class="token number">24</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span>
  <span class="token keyword">return</span> numberLEArray
<span class="token punctuation">}</span>

<span class="token keyword">let</span> loginTimestamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> loginNum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100000</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> appKey <span class="token operator">=</span> <span class="token string">'********'</span> <span class="token comment">// change it to your own app key</span>
<span class="token keyword">let</span> sig <span class="token operator">=</span> <span class="token function">encryptSig</span><span class="token punctuation">(</span>appKey<span class="token punctuation">,</span> loginTimestamp<span class="token punctuation">,</span> loginNum<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><hr> <h2 id="_5-接口鉴权"><a href="#_5-接口鉴权" aria-hidden="true" class="header-anchor">#</a> 5. 接口鉴权</h2> <h3 id="_5-1-使用用户信息登录（邮箱-qq-微信账号登录）"><a href="#_5-1-使用用户信息登录（邮箱-qq-微信账号登录）" aria-hidden="true" class="header-anchor">#</a> 5.1 使用用户信息登录（邮箱/QQ/微信账号登录）</h3> <ul><li>请求url: <code>/common/ticket/loginByUser</code></li> <li>请求方式: <code>get</code></li> <li>描述: 用于获取token和iotim_ticket。适用于先登录过微瓴开放平台，已经有用户登录态的情况。例如从微瓴开放平台拉起客户端，从session中获取用户登录信息，然后使用该接口调用API获取动态密钥token和物联票据iotim_ticket。</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">appid</td> <td style="text-align:center;">Long</td> <td style="text-align:center;">Yes</td> <td style="text-align:center;">应用系统的appid，新增应用后系统自动生成</td></tr> <tr><td style="text-align:center;">time</td> <td style="text-align:center;">Long</td> <td style="text-align:center;">是</td> <td style="text-align:center;">当前北京时间的时间戳</td></tr> <tr><td style="text-align:center;">num</td> <td style="text-align:center;">Long</td> <td style="text-align:center;">是</td> <td style="text-align:center;">加密时的随机数</td></tr> <tr><td style="text-align:center;">sig</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">用于鉴权的密文，生成方式见签名生成样例</td></tr> <tr><td style="text-align:center;">loginKey</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">cookie中mvs_unified_login_token_key字段的值。支持QQ、微信、邮箱账号登录。</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code>/common/ticket/loginByUser
?appid=10000
&amp;time=1494765993240
&amp;num=1518
&amp;sig=*****************************
&amp;loginKey=************************************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">Json</td> <td style="text-align:center;">查询结果</td></tr> <tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">动态密钥，20分钟过期</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">物联票据</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;iotim_ticket&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*****************&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;******************&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_5-2-使用后台方式登录"><a href="#_5-2-使用后台方式登录" aria-hidden="true" class="header-anchor">#</a> 5.2 使用后台方式登录</h3> <ul><li>请求url: <code>/common/ticket/loginByApp</code></li> <li>请求方式: <code>get</code></li> <li>描述: 用于获取token和iotim_ticket。适用于不关注用户信息，通过后台方式获取调用API的访问权限的场景。开发者可以使用开放平台分配的app_ticket通过该接口获取动态密钥token和物联票据iotim_ticket。</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">appid</td> <td style="text-align:center;">Long</td> <td style="text-align:center;">是</td> <td style="text-align:center;">应用系统的App ID，由系统自动分配</td></tr> <tr><td style="text-align:center;">time</td> <td style="text-align:center;">Long</td> <td style="text-align:center;">是</td> <td style="text-align:center;">当前北京时间的时间戳</td></tr> <tr><td style="text-align:center;">num</td> <td style="text-align:center;">Long</td> <td style="text-align:center;">是</td> <td style="text-align:center;">加密时的随机数</td></tr> <tr><td style="text-align:center;">sig</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">用于鉴权的密文，生成方式见签名生成样例</td></tr> <tr><td style="text-align:center;">app_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">开放平台分配的票据，用于登录鉴权</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code>/common/ticket/loginByApp
?time=1520231107761
&amp;num=1
&amp;sig=*****************************
&amp;appid=*****
&amp;app_ticket=*******************************************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">Json</td> <td style="text-align:center;">查询结果</td></tr> <tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">动态密钥，20分钟过期</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">物联票据</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;iotim_ticket&quot;</span><span class="token operator">:</span>
      <span class="token string">&quot;*******************************************************&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;token&quot;</span><span class="token operator">:</span>
      <span class="token string">&quot;*******************************************************&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_6-设备管理"><a href="#_6-设备管理" aria-hidden="true" class="header-anchor">#</a> 6. 设备管理</h2> <h3 id="_6-1-获取设备列表"><a href="#_6-1-获取设备列表" aria-hidden="true" class="header-anchor">#</a> 6.1 获取设备列表</h3> <ul><li>请求url: <code>/common/device/getDeviceList</code></li> <li>请求方式: <code>get</code></li> <li>描述: 根据条件查询设备列表信息</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的动态密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的物联票据</td></tr> <tr><td style="text-align:center;">num</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">是</td> <td style="text-align:center;">分页参数：每页记录数，最大返回100</td></tr> <tr><td style="text-align:center;">page</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">是</td> <td style="text-align:center;">分页参数：当前页码</td></tr> <tr><td style="text-align:center;">pid</td> <td style="text-align:center;">Long</td> <td style="text-align:center;">否</td> <td style="text-align:center;">查询条件：设备所属的产品的id</td></tr> <tr><td style="text-align:center;">sn</td> <td style="text-align:center;">String</td> <td style="text-align:center;">否</td> <td style="text-align:center;">查询条件：设备序列号</td></tr> <tr><td style="text-align:center;">din</td> <td style="text-align:center;">String</td> <td style="text-align:center;">否</td> <td style="text-align:center;">查询条件：设备在微瓴的唯一标志</td></tr> <tr><td style="text-align:center;">parent_din</td> <td style="text-align:center;">String</td> <td style="text-align:center;">否</td> <td style="text-align:center;">查询条件：父设备</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code>/common/device/getDeviceList?page=1
&amp;num=999
&amp;token=***************
&amp;iotim_ticket=*********************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">Json</td> <td style="text-align:center;">查询结果</td></tr> <tr><td style="text-align:center;">totalpage</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">总页数</td></tr> <tr><td style="text-align:center;">totalrow</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">总数量</td></tr> <tr><td style="text-align:center;">list</td> <td style="text-align:center;">JsonArray</td> <td style="text-align:center;">设备详细信息列表</td></tr> <tr><td style="text-align:center;">din</td> <td style="text-align:center;">String</td> <td style="text-align:center;">设备在微瓴的唯一标志</td></tr> <tr><td style="text-align:center;">product_id</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">设备所属产品id</td></tr> <tr><td style="text-align:center;">position</td> <td style="text-align:center;">String</td> <td style="text-align:center;">设备位置信息</td></tr> <tr><td style="text-align:center;">device_status</td> <td style="text-align:center;">String</td> <td style="text-align:center;">设备在线状态，online-在线，offline-离线</td></tr> <tr><td style="text-align:center;">isLive</td> <td style="text-align:center;">boolean</td> <td style="text-align:center;">推流状态（仅摄像机有该状态）</td></tr> <tr><td style="text-align:center;">device_name</td> <td style="text-align:center;">String</td> <td style="text-align:center;">设备名称</td></tr> <tr><td style="text-align:center;">device_nick</td> <td style="text-align:center;">String</td> <td style="text-align:center;">设备昵称</td></tr> <tr><td style="text-align:center;">device_type</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">设备类型编码</td></tr> <tr><td style="text-align:center;">dt_name</td> <td style="text-align:center;">String</td> <td style="text-align:center;">设备类型名称</td></tr> <tr><td style="text-align:center;">sn</td> <td style="text-align:center;">String</td> <td style="text-align:center;">设备序列号</td></tr> <tr><td style="text-align:center;">point_name</td> <td style="text-align:center;">String</td> <td style="text-align:center;">设备点位名称</td></tr> <tr><td style="text-align:center;">coordinate</td> <td style="text-align:center;">String</td> <td style="text-align:center;">设备坐标点，格式(x,y,z)</td></tr> <tr><td style="text-align:center;">parent_din</td> <td style="text-align:center;">String</td> <td style="text-align:center;">父设备</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;totalpage&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;totalrow&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;list&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token property">&quot;device_status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;offline&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;device_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GB9ZA0O0QL000001&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;coordinate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;dt_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;人脸识别一体机&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;product_id&quot;</span><span class="token operator">:</span> <span class="token number">1700005883</span><span class="token punctuation">,</span>
      <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;300000000000000081&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;parent_din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;300000000000000080&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;device_nick&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GB9ZA0O0QL000001&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;device_type&quot;</span><span class="token operator">:</span> <span class="token number">67</span><span class="token punctuation">,</span>
      <span class="token property">&quot;sn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GB9ZA0O0QL000001&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;position&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_飞亚达大厦_4楼_办公室_x,y(非必填)&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;point_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><hr> <h2 id="_7-服务管理"><a href="#_7-服务管理" aria-hidden="true" class="header-anchor">#</a> 7. 服务管理</h2> <h3 id="_7-1-调用第三方服务"><a href="#_7-1-调用第三方服务" aria-hidden="true" class="header-anchor">#</a> 7.1 调用第三方服务</h3> <ul><li>请求url: <code>/common/logic/call</code></li> <li>请求方式: <code>POST</code></li> <li>描述: 应用通过该接口访问开放平台上发布的服务。</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的动态密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的物联票据</td></tr> <tr><td style="text-align:center;">service_id</td> <td style="text-align:center;">Long</td> <td style="text-align:center;">是</td> <td style="text-align:center;">访问的服务的id</td></tr> <tr><td style="text-align:center;">api_id</td> <td style="text-align:center;">Long</td> <td style="text-align:center;">是</td> <td style="text-align:center;">访问的服务下的某个api的id</td></tr> <tr><td style="text-align:center;">params</td> <td style="text-align:center;">JsonArray</td> <td style="text-align:center;">否</td> <td style="text-align:center;">服务的api的参数数组</td></tr> <tr><td style="text-align:center;">name</td> <td style="text-align:center;">String</td> <td style="text-align:center;">否</td> <td style="text-align:center;">参数名</td></tr> <tr><td style="text-align:center;">value</td> <td style="text-align:center;">All</td> <td style="text-align:center;">否</td> <td style="text-align:center;">参数值</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code> /common/logic/call?
service_id=******
&amp;api_id=******
&amp;iotim_ticket=*********************************************************
&amp;token=*********************************************************
a.headers：Content-Type: application/json
b.body: {&quot;params&quot;: [{&quot;name&quot;:&quot;a&quot;, &quot;value&quot;:&quot;a&quot;},{&quot;name&quot;:&quot;b&quot;, &quot;value&quot;:&quot;2&quot;}]}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><hr> <h2 id="_8-帐号权限"><a href="#_8-帐号权限" aria-hidden="true" class="header-anchor">#</a> 8. 帐号权限</h2> <h3 id="_8-1-获取当前用户信息"><a href="#_8-1-获取当前用户信息" aria-hidden="true" class="header-anchor">#</a> 8.1 获取当前用户信息</h3> <ul><li>请求url: <code>/common/account/getCurrentUserInfo</code></li> <li>请求方式: <code>get</code></li> <li>描述: 获取当前登录用户的的信息，包括用户的角色列表</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的动态密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的物联票据</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code> /common/account/getCurrentUserInfo?
token=************************************************************
&amp;iotim_ticket=*********************************************************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">Json</td> <td style="text-align:center;">查询结果</td></tr> <tr><td style="text-align:center;">user_id</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">用户id</td></tr> <tr><td style="text-align:center;">head_image_url</td> <td style="text-align:center;">String</td> <td style="text-align:center;">用户头像url</td></tr> <tr><td style="text-align:center;">username</td> <td style="text-align:center;">String</td> <td style="text-align:center;">用户中文名</td></tr> <tr><td style="text-align:center;">username_en</td> <td style="text-align:center;">String</td> <td style="text-align:center;">用户英文名</td></tr> <tr><td style="text-align:center;">role_list</td> <td style="text-align:center;">JSONArray</td> <td style="text-align:center;">用户角色列表</td></tr> <tr><td style="text-align:center;">role_code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">角色代码</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;user_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;999&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;head_img_url&quot;</span><span class="token operator">:</span>
      <span class="token string">&quot;http://wx.qlogo.cn/mmopen/vi_32/WEFSDFS2MjCsaH7ib3AwMZ5fldlF2bJW9nFxIemMYCvVJHkjtzNTibap7eNdAyHW9NekueIvuFibVV6pkG7pb9bW5A/0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;测试用户名&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;username_en&quot;</span><span class="token operator">:</span> <span class="token string">&quot;testuser&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;role_list&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token property">&quot;role_code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_8-2-新增角色"><a href="#_8-2-新增角色" aria-hidden="true" class="header-anchor">#</a> 8.2 新增角色</h3> <ul><li>请求url: <code>/common/account/addAPIRole</code></li> <li>请求方式: <code>get</code></li> <li>描述: 给当前应用新增一个API角色</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的动态密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的物联票据</td></tr> <tr><td style="text-align:center;">role_name</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">角色名，中文请用utf8编码</td></tr> <tr><td style="text-align:center;">role_code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">角色代码，中文请用utf8编码</td></tr> <tr><td style="text-align:center;">description</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">角色描述，中文请用utf8编码</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code> /common/account/addAPIRole?
token=*******************************************************
&amp;role_name=管理员
&amp;role_code=admin5
&amp;description=测试帐号
&amp;iotim_ticket=*******************************************************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_8-3-删除角色"><a href="#_8-3-删除角色" aria-hidden="true" class="header-anchor">#</a> 8.3 删除角色</h3> <ul><li><p>请求url: <code>/common/account/delAPIRole</code></p></li> <li><p>请求方式: <code>get</code></p></li> <li><p>描述: 删除当前应用的一个API角色，被删除的角色代码不能再使用</p></li> <li><p>参数列表:
|   字段名称   | 字段类型 | 是否必须 |           字段描述           |
| :----------: | :------: | :------: | :--------------------------: |
|    token     |  String  |    是    | 鉴权参数：登录获取的动态密钥 |  |
| iotim_ticket |  String  |    是    | 鉴权参数：登录获取的物联票据 |  |
|  role_code   |  String  |    是    |  角色代码，中文请用utf8编码  |  |</p></li> <li><p>请求示例：</p></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code> /common/account/delAPIRole?
token=*******************************************************
&amp;role_code=admin5
&amp;iotim_ticket=*******************************************************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_8-4-查询角色"><a href="#_8-4-查询角色" aria-hidden="true" class="header-anchor">#</a> 8.4 查询角色</h3> <ul><li>请求url: <code>/common/account/findAPIRoleList</code></li> <li>请求方式: <code>get</code></li> <li>描述: 根据角色代码查询角色信息</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的动态密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的物联票据</td></tr> <tr><td style="text-align:center;">role_code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">角色代码，中文请用utf8编码</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code> /common/account/delAPIRole?
token=*******************************************************
&amp;iotim_ticket=*******************************************************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">JSONArray</td> <td style="text-align:center;">角色信息列表</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
<span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;role_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;管理员&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;role_code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admin1&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;测试帐号&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_8-5-新增角色与设备关系"><a href="#_8-5-新增角色与设备关系" aria-hidden="true" class="header-anchor">#</a> 8.5 新增角色与设备关系</h3> <ul><li>请求url: <code>/common/account/addRoleDeviceRelation</code></li> <li>请求方式: <code>GET</code></li> <li>描述: 该接口用于添加角色和设备之间的关系，例如给角色赋予设备的读权限。如果应用有这个角色，应用就可以读取该设备的数据。</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的动态密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的物联票据</td></tr> <tr><td style="text-align:center;">role_code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">角色代码，中文请用utf8编码</td></tr> <tr><td style="text-align:center;">din</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">设备在微瓴的唯一标识</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code> /common/account/addRoleDeviceRelation?
token=*******************************************************
&amp;role_code=admin1
&amp;din=******************
&amp;iotim_ticket=*******************************************************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_8-6-删除角色与设备关系"><a href="#_8-6-删除角色与设备关系" aria-hidden="true" class="header-anchor">#</a> 8.6 删除角色与设备关系</h3> <ul><li>请求url: <code>/common/account/delRoleDeviceRelation</code></li> <li>请求方式: <code>GET</code></li> <li>描述: 用于删除角色和设备之间的关系，删除角色对设备的控制权限</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的动态密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的物联票据</td></tr> <tr><td style="text-align:center;">role_code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">角色代码，中文请用utf8编码</td></tr> <tr><td style="text-align:center;">din</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">设备在微瓴的唯一标识</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code> /common/account/delRoleDeviceRelation?
token=*******************************************************
&amp;role_code=admin1
&amp;din=******************
&amp;iotim_ticket=*******************************************************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr> <tr><td style="text-align:center;">del_count</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">删除的记录数</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;del_count&quot;</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_8-7-查询角色与设备关系"><a href="#_8-7-查询角色与设备关系" aria-hidden="true" class="header-anchor">#</a> 8.7 查询角色与设备关系</h3> <ul><li>请求url: <code>/common/account/findRoleDeviceRelation</code></li> <li>请求方式: <code>GET</code></li> <li>描述: 该接口用于查询该应用下某个角色有权限的设备列表信息。</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的动态密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的物联票据</td></tr> <tr><td style="text-align:center;">role_code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">角色代码，中文请用utf8编码</td></tr> <tr><td style="text-align:center;">num</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">是</td> <td style="text-align:center;">分页参数：每页显示的数量</td></tr> <tr><td style="text-align:center;">page</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">是</td> <td style="text-align:center;">分页参数：返回的页码</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code> /common/account/findRoleDeviceRelation?
token=*******************************************************
&amp;role_code=admin1
&amp;page=1
&amp;num=999
&amp;iotim_ticket=*******************************************************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">JSONArray</td> <td style="text-align:center;">查询结果</td></tr> <tr><td style="text-align:center;">totalPage</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">返回的总页数</td></tr> <tr><td style="text-align:center;">totalRow</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">返回的总量</td></tr> <tr><td style="text-align:center;">din</td> <td style="text-align:center;">String</td> <td style="text-align:center;">设备的唯一标识</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;totalpage&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;totalrow&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;list&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;******************&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;******************&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><hr> <h2 id="_9-消息广播"><a href="#_9-消息广播" aria-hidden="true" class="header-anchor">#</a> 9. 消息广播</h2> <h3 id="_9-1-发送消息到设备"><a href="#_9-1-发送消息到设备" aria-hidden="true" class="header-anchor">#</a> 9.1 发送消息到设备</h3> <ul><li>请求url: <code>/common/msg/send</code></li> <li>请求方式: <code>GET</code></li> <li>描述: 用于发送自定义数据格式的消息，通过微瓴透传给智能设备，并在设备中进行协议解析。</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的动态密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的物联票据</td></tr> <tr><td style="text-align:center;">din</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">设备的唯一标识</td></tr> <tr><td style="text-align:center;">datapoint</td> <td style="text-align:center;">Long</td> <td style="text-align:center;">是</td> <td style="text-align:center;">在微瓴物联平台申请的功能 ID</td></tr> <tr><td style="text-align:center;">cmd</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">给设备发送消息的内容，需 UrlEncode</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code> /common/msg/send?
token=*******************************************************
&amp;din=******************
&amp;datapoint=100001548
&amp;cmd=test
&amp;iotim_ticket=*******************************************************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">Json</td> <td style="text-align:center;">返回数据</td></tr> <tr><td style="text-align:center;">seq</td> <td style="text-align:center;">String</td> <td style="text-align:center;">该次请求的seq</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;seq&quot;</span><span class="token operator">:</span> <span class="token number">5031738</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_9-2-智能设备控制"><a href="#_9-2-智能设备控制" aria-hidden="true" class="header-anchor">#</a> 9.2 智能设备控制</h3> <ul><li>请求url: <code>/common/msg/controller</code></li> <li>请求方式: <code>GET</code></li> <li>描述: 用于发送消息到设备，需要实现对应设备协议。</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的动态密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的物联票据</td></tr> <tr><td style="text-align:center;">din</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">设备的唯一标识</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">控制内容，需 UrlEncode</td></tr> <tr><td style="text-align:center;">seq</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">是</td> <td style="text-align:center;">序列号。在同一个 din 之中相邻的两条请求中，如果 seq 相同则屏蔽后一条</td></tr> <tr><td style="text-align:center;">sub_id</td> <td style="text-align:center;">JsonArray</td> <td style="text-align:center;">否</td> <td style="text-align:center;">子节点 ID，用于对网关下设备进行群控操作，直连设备忽略该参数</td></tr> <tr><td style="text-align:center;">timestamp</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">时间戳，单位：毫秒</td></tr> <tr><td style="text-align:center;">cmd</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">控制命令</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code> /common/msg/controller?
token=*******************************************************
&amp;din=***************
&amp;data={
  &quot;timestamp&quot;:1494919323720,
  &quot;sub_id&quot;:[&quot;031605230002&quot;,&quot;031605230003&quot;],
  &quot;seq&quot;:1,
  &quot;cmd&quot;:{
    &quot;bri&quot;:50,
    &quot;on&quot;:true,
    &quot;rgb&quot;:[100,100,100],
    &quot;ct&quot;:100}
    }
&amp;iotim_ticket=*******************************************************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">Json</td> <td style="text-align:center;">操作结果</td></tr> <tr><td style="text-align:center;">update_num</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">录像记录修改数量</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
      <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token property">&quot;update_num&quot;</span><span class="token operator">:</span> <span class="token number">1000</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_9-3-获取文件上传"><a href="#_9-3-获取文件上传" aria-hidden="true" class="header-anchor">#</a> 9.3 获取文件上传</h3> <ul><li>请求url: <code>/common/msg/sendFile</code></li> <li>请求方式: <code>GET</code></li> <li>描述: 通过对象存储（Cloud Object Storage，简称：COS）发送文件到设备，获取文件在COS上的信息。</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的动态密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的物联票据</td></tr> <tr><td style="text-align:center;">dins</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">设备 din，可以以&quot;,&quot;分隔，发送给多个设备</td></tr> <tr><td style="text-align:center;">fileName</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">上传的文件名</td></tr> <tr><td style="text-align:center;">fileSize</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">是</td> <td style="text-align:center;">上传的文件大小，单位：byte</td></tr> <tr><td style="text-align:center;">hashCode</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">本次上传文件的 hash 值</td></tr> <tr><td style="text-align:center;">fileMD5</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">本次上传文件的 MD5 值</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">给设备发送的自定义消息内容</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code> /common/msg/sendFileToDeviceCOS?
token=*******************************************************
&amp;dins=***************
&amp;fileName=aaaaaaaaa.txt
&amp;fileSize=309
&amp;hashCode=1f621eb56afd3fb3ef34f32aa32c8d2b8da1d8a4
&amp;fileMD5=3559f27db06b63c1255eee91423f2a33
&amp;data=CustomMessage
&amp;iotim_ticket=*******************************************************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">Json</td> <td style="text-align:center;">操作结果</td></tr> <tr><td style="text-align:center;">file_id</td> <td style="text-align:center;">String</td> <td style="text-align:center;">该次发送的文件 ID</td></tr> <tr><td style="text-align:center;">cos_authorization</td> <td style="text-align:center;">String</td> <td style="text-align:center;">上传至 COS 系统所需的授权码</td></tr> <tr><td style="text-align:center;">url</td> <td style="text-align:center;">String</td> <td style="text-align:center;">上传文件路径</td></tr> <tr><td style="text-align:center;">host</td> <td style="text-align:center;">String</td> <td style="text-align:center;">上传至 cos 时的 header</td></tr> <tr><td style="text-align:center;">x-cos-content-sha1</td> <td style="text-align:center;">String</td> <td style="text-align:center;">上传至 cos 时的 header</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;cos_authorization&quot;</span><span class="token operator">:</span>
      <span class="token string">&quot;q-sign-algorithm=sha1&amp;q-ak=JwxbdHXcgrqZyWxNsqqdDnN0&amp;q-sign-time=1508341748;1508345348&amp;q-key-time=1508341748;1508345348&amp;q-header-list=host;x-cos-content-sha1&amp;q-url-param-list=&amp;q-signature=d5d56419e4c962df6d49771ac248fd83791a58c6&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span>
      <span class="token string">&quot;http://mvsfile-30035.sz.gfp.tencent-cloud.com/download/20171018/aaaaaaaaa.txt&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;file_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a7fd2ca2-78b9-42e8-b153-8724cbdec5bf&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mvsfile-30035.sz.gfp.tencent-cloud.com&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;x-cos-content-sha1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a1a16419e4c962d5e149771ac248fd83791845ea&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_9-4-通知平台文件已上传"><a href="#_9-4-通知平台文件已上传" aria-hidden="true" class="header-anchor">#</a> 9.4 通知平台文件已上传</h3> <ul><li>请求url: <code>/common/msg/fileNotify</code></li> <li>请求方式: <code>GET</code></li> <li>描述: 通知平台发送文件在COS上链接到具体的设备。</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的动态密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数：登录获取的物联票据</td></tr> <tr><td style="text-align:center;">fileId</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">文件 ID</td></tr> <tr><td style="text-align:center;">uploadResult</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">上传文件结果，success：成功，fail：失败</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code> /common/msg/controller?
token=*******************************************************
&amp;fileId=0fdb0373-1921-4b87-90ff-41740670bff0
&amp;uploadResult=success
&amp;iotim_ticket=*******************************************************
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_9-5-消息推送接口"><a href="#_9-5-消息推送接口" aria-hidden="true" class="header-anchor">#</a> 9.5 消息推送接口</h3> <ul><li>请求url: <code>/common/msg/report</code></li> <li>请求方式: <code>POST</code></li> <li>描述: 消息广播接口，发送消息到平台。</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">token</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数，登录获取的动态密钥</td></tr> <tr><td style="text-align:center;">iotim_ticket</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">鉴权参数，登录获取的物联票据</td></tr> <tr><td style="text-align:center;">message_type</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">是</td> <td style="text-align:center;">消息类型，详见附录</td></tr> <tr><td style="text-align:center;">content</td> <td style="text-align:center;">Object</td> <td style="text-align:center;">是</td> <td style="text-align:center;">消息内容，详见附录</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code> /common/msg/report?
token=*******************************************************
&amp;iotim_ticket=*******************************************************
a.请求头：Content-Type:application/json
b.请求包体:{&quot;message_type&quot;:1000100,&quot;content&quot;:&quot;test content&quot;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>返回参数:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">message</td> <td style="text-align:center;">String</td> <td style="text-align:center;">执行结果消息</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">Json</td> <td style="text-align:center;">操作结果</td></tr> <tr><td style="text-align:center;">seq</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">消息的seq</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OK&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;seq&quot;</span><span class="token operator">:</span> <span class="token number">5031740</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_9-6-应用接收消息格式（来源应用）"><a href="#_9-6-应用接收消息格式（来源应用）" aria-hidden="true" class="header-anchor">#</a> 9.6 应用接收消息格式（来源应用）</h3> <ul><li>请求方式: <code>POST</code></li> <li>描述: 微瓴主动推送消息给到应用端的消息格式。</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">cookie</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">本条消息的cookie，接收到需要返回</td></tr> <tr><td style="text-align:center;">apiName</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">消息类型，&quot;report_data_point&quot;：表示设备主动上报，<br>&quot;set_data_point_res&quot;：表示设备是根据某条下发消息所回应的数据，<br>“api_broadcast ”来自于api 调用</td></tr> <tr><td style="text-align:center;">from_app</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">是</td> <td style="text-align:center;">消息来源的appid</td></tr> <tr><td style="text-align:center;">time</td> <td style="text-align:center;">Object</td> <td style="text-align:center;">是</td> <td style="text-align:center;">消息发送时间</td></tr> <tr><td style="text-align:center;">value</td> <td style="text-align:center;">Object</td> <td style="text-align:center;">是</td> <td style="text-align:center;">自定义消息内容</td></tr> <tr><td style="text-align:center;">seq</td> <td style="text-align:center;">Object</td> <td style="text-align:center;">是</td> <td style="text-align:center;">消息唯一编号</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code>a.请求头：Content-Type:application/json
b.请求包体:{&quot;apiName&quot;:&quot;api_broadcaster&quot;,&quot;cookie&quot;:&quot;29412_1063711&quot;,&quot;from_app&quot;:&quot;40291&quot;,&quot;time&quot;:1561014001593,&quot;value&quot;:&quot;value text&quot;,&quot;seq&quot;:&quot;13015327&quot;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>返回参数:
<code>需要消息接收方返回的内容</code></li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">cookie</td> <td style="text-align:center;">String</td> <td style="text-align:center;">请求时所带参数</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;cookie&quot;</span><span class="token operator">:</span> <span class="token string">&quot;29412_1063711&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_9-7-应用接收消息格式（来源设备）"><a href="#_9-7-应用接收消息格式（来源设备）" aria-hidden="true" class="header-anchor">#</a> 9.7 应用接收消息格式（来源设备）</h3> <ul><li>请求方式: <code>POST</code></li> <li>描述: 微瓴主动推送消息给到应用端的消息格式。</li> <li>参数列表:</li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">cookie</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">本条消息的cookie，接收到需要返回</td></tr> <tr><td style="text-align:center;">apiName</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">消息类型，&quot;report_data_point&quot;：表示设备主动上报，<br>&quot;set_data_point_res&quot;：表示设备是根据某条下发消息所回应的数据，<br>“api_broadcast ”来自于api 调用</td></tr> <tr><td style="text-align:center;">din</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">是</td> <td style="text-align:center;">设备唯一标识</td></tr> <tr><td style="text-align:center;">errmsg</td> <td style="text-align:center;">Object</td> <td style="text-align:center;">是</td> <td style="text-align:center;">异常消息内容</td></tr> <tr><td style="text-align:center;">id</td> <td style="text-align:center;">Object</td> <td style="text-align:center;">是</td> <td style="text-align:center;">datapoint id 表示功能ID 可选，硬件会上报，app也是可选项</td></tr> <tr><td style="text-align:center;">time</td> <td style="text-align:center;">Object</td> <td style="text-align:center;">是</td> <td style="text-align:center;">消息发送时间</td></tr> <tr><td style="text-align:center;">type</td> <td style="text-align:center;">Object</td> <td style="text-align:center;">是</td> <td style="text-align:center;">消息格式</td></tr> <tr><td style="text-align:center;">value</td> <td style="text-align:center;">Object</td> <td style="text-align:center;">是</td> <td style="text-align:center;">自定义消息内容</td></tr> <tr><td style="text-align:center;">seq</td> <td style="text-align:center;">Object</td> <td style="text-align:center;">是</td> <td style="text-align:center;">消息唯一编号</td></tr></tbody></table> <ul><li>请求示例：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-text"><code>a.请求头：Content-Type:application/json
b.请求包体:{
  &quot;apiName&quot;: &quot;report_data_point&quot;,
  &quot;cookie&quot;: &quot;16198_577418&quot;,
  &quot;din&quot;: &quot;********&quot;,
  &quot;errmsg&quot;: &quot;&quot;,
  &quot;id&quot;: 20134,
  &quot;time&quot;: 1511802600575,
  &quot;type&quot;: &quot;string&quot;,
  &quot;value&quot;:&quot;{\&quot;V\&quot;:1,\&quot;subid\&quot;:\&quot;0900009\&quot;,\&quot;list\&quot;:[{\&quot;func\&quot;:\&quot;CO2\&quot;,\&quot;value\&quot;:\&quot;972180.00\&quot;}],\&quot;timestamp\&quot;:1511802557768}&quot;,
  &quot;seq&quot;: &quot;0&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>返回参数:
<code>需要消息接收方返回的内容</code></li></ul> <table><thead><tr><th style="text-align:center;">字段名称</th> <th style="text-align:center;">字段类型</th> <th style="text-align:center;">字段描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">错误码，0表示成功，其他见错误码说明</td></tr> <tr><td style="text-align:center;">cookie</td> <td style="text-align:center;">String</td> <td style="text-align:center;">请求时所带参数</td></tr></tbody></table> <ul><li>返回格式:</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;cookie&quot;</span><span class="token operator">:</span> <span class="token string">&quot;29412_1063711&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/IOT.html" class="prev">IOT通讯协议</a></span> <span class="next"><a href="/Video_service.html">视频服务</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.db21f27a.js" defer></script><script src="/assets/js/2.82b08f5a.js" defer></script><script src="/assets/js/7.04069a34.js" defer></script>
  </body>
</html>
