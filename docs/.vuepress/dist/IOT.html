<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OPEN API Doc</title>
    <meta name="description" content="接口说明文档">
    <link rel="icon" href="/bitbug_favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.584498ef.css" as="style"><link rel="preload" href="/assets/js/app.db21f27a.js" as="script"><link rel="preload" href="/assets/js/2.82b08f5a.js" as="script"><link rel="preload" href="/assets/js/9.4b85b1ac.js" as="script"><link rel="prefetch" href="/assets/js/10.22aa21c7.js"><link rel="prefetch" href="/assets/js/11.2b479cd9.js"><link rel="prefetch" href="/assets/js/12.d0a30bd4.js"><link rel="prefetch" href="/assets/js/13.e1c32ab9.js"><link rel="prefetch" href="/assets/js/14.a358029f.js"><link rel="prefetch" href="/assets/js/15.b95dcb64.js"><link rel="prefetch" href="/assets/js/3.69a9e6aa.js"><link rel="prefetch" href="/assets/js/4.2a9a9e3e.js"><link rel="prefetch" href="/assets/js/5.ddaaa47b.js"><link rel="prefetch" href="/assets/js/6.898b7d41.js"><link rel="prefetch" href="/assets/js/7.04069a34.js"><link rel="prefetch" href="/assets/js/8.13be9294.js">
    <link rel="stylesheet" href="/assets/css/0.styles.584498ef.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">OPEN API Doc</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/Guide.html" class="sidebar-link">接入指南</a></li><li><a href="/IOT.html" class="active sidebar-link">IOT通讯协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/IOT.html#_1-设备接入" class="sidebar-link">1. 设备接入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/IOT.html#_1-1-注册v2" class="sidebar-link">1.1 注册v2</a></li><li class="sidebar-sub-header"><a href="/IOT.html#_1-2-挑战应答" class="sidebar-link">1.2 挑战应答</a></li><li class="sidebar-sub-header"><a href="/IOT.html#_1-3-登录v2" class="sidebar-link">1.3 登录V2</a></li></ul></li><li class="sidebar-sub-header"><a href="/IOT.html#_2-自定义消息" class="sidebar-link">2 自定义消息</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/IOT.html#_2-1-mqtt" class="sidebar-link">2.1 MQTT</a></li><li class="sidebar-sub-header"><a href="/IOT.html#_2-2-http" class="sidebar-link">2.2 HTTP</a></li></ul></li><li class="sidebar-sub-header"><a href="/IOT.html#_3-微瓴iot基础协议" class="sidebar-link">3 微瓴IOT基础协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/IOT.html#_3-1-标准消息格式（byte-）" class="sidebar-link">3.1 标准消息格式（byte[]）</a></li><li class="sidebar-sub-header"><a href="/IOT.html#_3-2-直连设备心跳消息（byte-）" class="sidebar-link">3.2 直连设备心跳消息（byte[]）</a></li><li class="sidebar-sub-header"><a href="/IOT.html#_3-3-网关上报子设备注册消息（byte-）" class="sidebar-link">3.3 网关上报子设备注册消息（byte[]）</a></li><li class="sidebar-sub-header"><a href="/IOT.html#_3-4-子设备列表接收（byte-）" class="sidebar-link">3.4 子设备列表接收（byte[]）</a></li><li class="sidebar-sub-header"><a href="/IOT.html#_3-5-获取云端子设备列表信息（byte-）" class="sidebar-link">3.5 获取云端子设备列表信息（byte[]）</a></li><li class="sidebar-sub-header"><a href="/IOT.html#_3-6-子设备状态列表上报（byte-）" class="sidebar-link">3.6 子设备状态列表上报（byte[]）</a></li><li class="sidebar-sub-header"><a href="/IOT.html#_3-7-设备下载文件" class="sidebar-link">3.7 设备下载文件</a></li><li class="sidebar-sub-header"><a href="/IOT.html#_3-8-设备上传文件" class="sidebar-link">3.8 设备上传文件</a></li><li class="sidebar-sub-header"><a href="/IOT.html#_3-9-网关请求子设备列表" class="sidebar-link">3.9 网关请求子设备列表</a></li><li class="sidebar-sub-header"><a href="/IOT.html#_3-10-ota更新" class="sidebar-link">3.10 OTA更新</a></li><li class="sidebar-sub-header"><a href="/IOT.html#_3-11-设备升级成功后上报升级结果" class="sidebar-link">3.11 设备升级成功后上报升级结果</a></li></ul></li></ul></li><li><a href="/Application_of_API.html" class="sidebar-link">应用API</a></li><li><a href="/Video_service.html" class="sidebar-link">视频服务</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数字空间</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/Error_code.html" class="sidebar-link">错误码</a></li><li><a href="/appendix.html" class="sidebar-link">附录</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>[TOC]</p> <h1 id="微瓴iot通讯协议"><a href="#微瓴iot通讯协议" aria-hidden="true" class="header-anchor">#</a> 微瓴IOT通讯协议</h1> <p>通讯协议采用 <code>TLV</code> 结构，既type，length，value，其中type占2个字节，length占4字节（32位无符号整型），value的长度根据length的值来定义。 <code>密文使用16进制文本传输</code>。
value的格式使用json字符串，采用utf-8编码
服务端公钥找微瓴对接人获取</p> <blockquote><p>注册服务器IP地址找微瓴对接人获取
挑战应答、登录的IP地址来源于注册时返回的accessAddr</p></blockquote> <div class="language-text line-numbers-mode"><pre class="language-text"><code>本文档示例中使用的设备SM2非对称秘钥如下（需要设备接入方自己生成，并提供公钥给微瓴侧）
私钥：649AFC433B485AF5B35D3A32647FECE8DBD4DD667990F46B691431DEE79F56C9
公钥：E7B81823186EE3C932ACF4CA4C3813A026ECD3FD1CDEF10F7D870E0701BB537B369EC087753E1034EAAF697D9A0BA0164AF2A5002ED18A82C8F011E3A2455C2D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_1-设备接入"><a href="#_1-设备接入" aria-hidden="true" class="header-anchor">#</a> 1. 设备接入</h2> <h3 id="_1-1-注册v2"><a href="#_1-1-注册v2" aria-hidden="true" class="header-anchor">#</a> 1.1 注册v2</h3> <ul><li>协议字
<code>0x000D</code></li> <li>通讯协议</li> <li>客户端请求包</li></ul> <table><thead><tr><th>key</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>v</td> <td>Integer</td> <td>数据协议版本号,此版本号为2</td></tr> <tr><td>pid</td> <td>String</td> <td>productId，产品IP，从微瓴开放平台申请</td></tr> <tr><td>data</td> <td>jsonObject</td> <td>数据内容，通过<code>服务器公钥加密传输</code></td></tr> <tr><td>sn</td> <td>String</td> <td>设备序列号，厂商自己生成</td></tr> <tr><td>lic</td> <td>String</td> <td>通过设备私钥生成的licence，SM2(pid+sn)，签名时使用的userId为当前pid</td></tr> <tr><td>ts</td> <td>Long</td> <td>当前时间</td></tr> <tr><td>mac</td> <td>String</td> <td>加密后的data所计算的md5值</td></tr></tbody></table> <ul><li>示例</li></ul> <p>明文</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">&quot;pid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1700001111&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;sn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3882DAE344F746a5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;304602210086F7246ED83540A5706053BB80B5A4F0BFEC4EB8CFC392410FD0EA4033595056022100EE56B4973705C5D1B75DD1B8178BFDA4D0A36C5E1F45EA51A12E3BCAB2461BD7&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ts&quot;</span><span class="token operator">:</span> <span class="token number">1551605124123</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ffdc6e3389dd6403af559ccad0d2f6e4&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>SM2加密后</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">&quot;pid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1700001111&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;308201190221009C5AE288D27D55ACCBF76F1B843996AB985FC3465365FA62268E4683846A56B0022073CCA17DEDBD132A82778D7D1B9E0E52E5458DA1E087AFD05A0BFA3E6D92B41B0420177FE436608BB469404611D7794B540440E7353527FBE7BB76ADBE10395C4BE00481AFAC6FB448A5C58692B61FBA855A23F5B3525F3DE0730917B6ECF6B6C0FEB07938F15A48D05FED53E075B63F7254A3D763EC11B959D83CB8CCF14CEC299F21ABD2D89B2C21B37963ADB3FD9E1109C150231A9AD45FE43968D945FBBFAC4805AFB567692E24175D4B0317B66FB0DFE683C758B52A31D260AFCE165F7BF7BAF7C3758B9FD78AD95C9FD1AAE24DE5B58B59D30674E457AA57F7ACD993DD793F980FCC0E05154AAC80F69C814125E96710C7&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ffdc6e3389dd6403af559ccad0d2f6e4&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>TCP传输的完整内容</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>000D000002C07B2264617461223A2233303832303134323032323037363633313438343541413938304130433731324437344531303636464445424331313245363233364439324231313133454439303738333630344530463936303232313030424444434533444537393432443943333938384644374436383146423046354343333342304237364230313741324134343942303641394232374443424343383034323034363343363146453841354131433844413231334336363739343036463937443236364230384238303946423533414439443343333346463545463534423635303438314438364434413141443834443545463542443039343931333446453741363337344236354432353937383044383041383643364231343441304441434533343731433644454343414442373941464436303642444145334341313446463733313441383338353144434643353033333634313337313731394546373437323743353844444133423242333436464236324334414333444242413842384331383634313837423738353238464236383536423441433142324235463135394346373539423939393137443745344142353134454441323337384437344542374243423341373745333744444138313339303835373045394341343932313037424446393934423133423335393346443831453041423836384536363141413542354235364232394145443939454541454543333844363439343542314246413333374532464132394145374635463239384233363433324232394333463741393231444245343734394144433145413246363137424445463446454643414339444536343844323139353646384346463632453643353545443331314235373638363735434136433339374331343945363331222C226D6163223A226666646336653333383964643634303361663535396363616430643266366534227D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>服务端返回包</li></ul> <table><thead><tr><th>key</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>*v</td> <td>Integer</td> <td>数据协议版本号,此版本号为2</td></tr> <tr><td>*code</td> <td>Integer</td> <td>请求错误码，0为成功</td></tr> <tr><td>*msg</td> <td>String</td> <td>消息返回错误信息</td></tr> <tr><td>*data</td> <td>jsonObject</td> <td>数据内容，通过<code>设备公钥加密</code></td></tr> <tr><td>*din</td> <td>String</td> <td>设备在云端的唯一标识，后续登录和通讯都已din为准。</td></tr> <tr><td>*mqttServer</td> <td>String</td> <td>MQTT服务链接地址</td></tr> <tr><td>*mqttClientId</td> <td>String</td> <td>MQTT服务客户端ID，目前同din</td></tr> <tr><td>*mqttUser</td> <td>String</td> <td>MQTT服务登录用户名</td></tr> <tr><td>*mqttPassword</td> <td>String</td> <td>MQTT服务登录密码</td></tr> <tr><td>*sslType</td> <td>String</td> <td>通讯加密类型，none：无加密，PSK：使用psk方式通讯，SSL：按照单向认证方式加密</td></tr> <tr><td>sslMqttServer</td> <td>String</td> <td>MQTT服务SSL地址</td></tr> <tr><td>sslMqttCA</td> <td>String</td> <td>ca证书，与mqttPSK互斥，二者只会返回一个</td></tr> <tr><td>mqttPSK</td> <td>String</td> <td>mqtt服务登录的psk，与mqttCA互斥，二者只会返回一个</td></tr> <tr><td>*mqttReciveTopic</td> <td>String</td> <td>设备订阅的topic</td></tr> <tr><td>*mqttPushTopic</td> <td>String</td> <td>设备推送消息使用的topic</td></tr> <tr><td>*httpDomain</td> <td>String</td> <td>http通讯请求的地址</td></tr> <tr><td>*innerUrl</td> <td>JSONArray</td> <td>http通讯内网请求的地址</td></tr> <tr><td>*projId</td> <td>String</td> <td>设备当前所属项目ID，为0表示未导入项目</td></tr> <tr><td>*projAccessAddr</td> <td>jsonArray</td> <td>设备当前所属项目登录地址</td></tr> <tr><td>*ts</td> <td>Long</td> <td>时间戳</td></tr> <tr><td>*mac</td> <td>String</td> <td>加密后的data所计算的md5值</td></tr></tbody></table> <ul><li>示例</li></ul> <p>返回密文</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;308201410221008B8F8EA1FA9E98288607E31EDA64A16C5E48FCC160953D9AE77DB9825B10A0F90220677ED0532D9FB3BEC7830DBCB0C409BF46A7B7773575F097940C0A9E2E4C14CA0420A991380DA426A768A0C6AB976138DC9277920689C8A576341372C88D113D06D50481D74D806A56FC9A4DF7EF6940917588742516BA714A46799CC31E2D6DA7282B616CF65911572DCECC11D1186B539994366F048539989168EAC03EF118531DFF2EC2EC59B8001D854CA0907AE892793D6C1BEB5F6BB49C1641A4F172628B1760AA5FAC4E83E519258E55D90D2D6B1D51E361B07CB5D359E0CBFAE6A08D18F417776D5BE662134E4D7EAAE3270027819F5E9C4313EFDA343446916E653C45FB4251470F112F939169F619DA1EB3EADD16292B6B78CA204B30F1605546496B5AC3C79CD763088D2430BB6930D13D1F829DF9DDE10813199ACE53&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;f66b4284b8fa094abac52c7c89a5111c&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>解密后明文</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;mqttUser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;welink_client&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;mqttClientId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2000000000000001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2000000000000001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;mqttServer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tcp://127.0.0.1:18833&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;mqttPassword&quot;</span><span class="token operator">:</span><span class="token string">&quot;abcx123v&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sslMqttServer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ssl://127.0.0.1:8883&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sslMqttCA&quot;</span><span class="token operator">:</span><span class="token string">&quot;-----BEGIN CERTIFICATE-----\nMIID9TCCAt2gAwIBAgIJALoDrw8H0UW0MA0GCSqGSIb3DQEBCwUAMIGQMQswCQYD\nVQQGEwJDTjESMBAGA1UECAwJR3VhbmdEb25nMREwDwYDVQQHDAhTaGVuemhlbjEQ\nMA4GA1UECgwHVGVuY2VudDEPMA0GA1UECwwGd2VsaW5rMRQwEgYDVQQDDAttcXR0\nIGJyb2tlcjEhMB8GCSqGSIb3DQEJARYSd2VsaW5rQHRlbmNlbnQuY29tMB4XDTE5\nMDQyMjA3NTAwMFoXDTI5MDIyODA3NTAwMFowgZAxCzAJBgNVBAYTAkNOMRIwEAYD\nVQQIDAlHdWFuZ0RvbmcxETAPBgNVBAcMCFNoZW56aGVuMRAwDgYDVQQKDAdUZW5j\nZW50MQ8wDQYDVQQLDAZ3ZWxpbmsxFDASBgNVBAMMC21xdHQgYnJva2VyMSEwHwYJ\nKoZIhvcNAQkBFhJ3ZWxpbmtAdGVuY2VudC5jb20wggEiMA0GCSqGSIb3DQEBAQUA\nA4IBDwAwggEKAoIBAQDmtq0m4nnrbrec/1ncrJnPl0rle+tc5OQvt0t665g4xc5O\nIrDNWk6Nfc7fbjb9EGyieHxtugHGp3sfFbDUgYqr8MpN1/6iq5EkTJ9LGYvuqLWn\ndilFikHJQgAf6863YCL+tKpALst6iAalTe3KV2FWgNXvFNY9JjvkKCg8XnND8tBc\n8jPia/6FMA/MUXruMcI7nO2Z0MMXBsuOjiGsqSYjrjI3COg4zP1NrwXeapjnqBJW\n84mEAKN+7kDDuOoQMK/Bj1OBJa1kxB/HEgOA2/LkRl8c2poyl8LHhW72jeCVcmC0\nHcOxFSM/oHE08Z7qtzPFqlAlhfdvYOomL/41XmzpAgMBAAGjUDBOMB0GA1UdDgQW\nBBRP9R7z4fNYCnl3IyxNSYa/y7/idTAfBgNVHSMEGDAWgBRP9R7z4fNYCnl3IyxN\nSYa/y7/idTAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQCMRMsQWaoA\n1suE5sDKa6Cul/nCcrsgzZCRh60yLxCX3xe8P7wx7rV76mg9seWXB8gLTIvXikiF\ntOkoXyhcGBcAdOI+WbyQO1C7mS0l3ifKZ+ss2rHDqMOO0R4qnViE1Wpgg2xzZtmD\nVgWMp/gzWegPlY+28QN6DKNvqEcJuzUiA3pkJJhL3Uj+ga9XV4djCTaBKZICrL8a\nkro8PaHUggTHONoBYLuCKTvr3McmJw/SllFxkDLbVcXsbar9/4Kp9cuj7v6RqYYB\nunuwXQb/z/nidihp/XFpnvUKazPTGr98D1DsJOQTmkOu9MYZ9dNO23UjAdFlE0SK\nitYOTY5oUfH/\n-----END CERTIFICATE-----&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;httpDomain&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://api.weiling.qq.com&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;innerUrl&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;http://127.0.0.1:8094&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;http://127.0.0.1:8095&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;projId&quot;</span><span class="token operator">:</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;projAccessAddr&quot;</span><span class="token operator">:</span><span class="token string">&quot;192.168.1.2:18831&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ts&quot;</span><span class="token operator">:</span> <span class="token number">1543302296148</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;615e6a32de3178eb4c31812cb271f84a&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul><li>错误码</li></ul> <table><thead><tr><th>code</th> <th>description</th></tr></thead> <tbody><tr><td>10000</td> <td>上报数据格式异常</td></tr> <tr><td>10001</td> <td>sn格式非法或未放号</td></tr> <tr><td>10002</td> <td>没有上传设备公钥</td></tr> <tr><td>10003</td> <td>mac验证失败</td></tr></tbody></table> <blockquote><p>1.licence生成，使用SM2算法用设备私钥加密pid+sn字符串获得，签名的userId使用pid
2.示例的内容是明文，实际传输需要加密后再传输。</p></blockquote> <hr> <h3 id="_1-2-挑战应答"><a href="#_1-2-挑战应答" aria-hidden="true" class="header-anchor">#</a> 1.2 挑战应答</h3> <ul><li><p>协议字
<code>0x000B</code></p></li> <li><p>通讯协议</p></li> <li><p>客户端请求包
01</p></li> <li><p>示例
以下为完整报文</p></li></ul> <div class="language-text line-numbers-mode"><pre class="language-text"><code>000B0000000101
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>服务端返回包</li></ul> <table><thead><tr><th>key</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>v</td> <td>Integer</td> <td>数据协议版本号</td></tr> <tr><td>code</td> <td>Integer</td> <td>请求错误码，0为成功</td></tr> <tr><td>msg</td> <td>String</td> <td>消息返回错误信息</td></tr> <tr><td>data</td> <td>Integer</td> <td>随机数</td></tr></tbody></table> <ul><li>示例</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token number">89741245</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><hr> <h3 id="_1-3-登录v2"><a href="#_1-3-登录v2" aria-hidden="true" class="header-anchor">#</a> 1.3 登录V2</h3> <ul><li>协议字
<code>0x000E</code></li> <li>通讯协议</li> <li>客户端请求包</li></ul> <table><thead><tr><th>key</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>v</td> <td>Integer</td> <td>数据协议版本号,此版本号为2</td></tr> <tr><td>pid</td> <td>String</td> <td>productId，产品IP，从微瓴开放平台申请</td></tr> <tr><td>data</td> <td>jsonObject</td> <td>数据内容，通过<code>服务器公钥加密</code></td></tr> <tr><td>din</td> <td>String</td> <td>注册时获得的din</td></tr> <tr><td>challenge_ran</td> <td>Integer</td> <td>挑战应答的随机数，非必填</td></tr> <tr><td>ran</td> <td>String</td> <td>SM4，向量参数，长度：16，格式：大小写字母+数字</td></tr> <tr><td>lic</td> <td>String</td> <td>通过设备私钥加密pid，sn，挑战应答返回的random所生成的licence，SM2(pid+sn+random)，签名时使用的userId为当前pid</td></tr> <tr><td>mac</td> <td>String</td> <td>加密后的data所计算的md5值</td></tr></tbody></table> <ul><li>示例</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">&quot;pid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1700001111&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2000000000000001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;challenge_ran&quot;</span><span class="token operator">:</span> <span class="token number">89741245</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ran&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1234567890ABCDEF&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;304402201E89D67349E6FFCA6F07BDC7FC6D5F9D90F91D8C750FA1021D68A79D0C66755E0220690A7733BDB8EA7AC88CDFF9F6A0DD018DCA4CA30D05EA970B31BBFB576E850B&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8fe88143292101072aea6f43b2628e78&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>SM2加密后</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">&quot;pid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1700001111&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3082014A02202139F013948043846E0C7C715BE03880D8BC951CE481EEE1AC671B71FE4DCAD402207244A20A40C8ABCDE4B984E3D8B8EEF64A457EE6255CFC11AD214CF01E6F737D0420DDEC40FD51866F6C6EC236D358E504E60777F49BB22E51F7B112264D421FAFF80481E1B55666D3EBB45235FF0C5654BED731FFA6B71A45E6455D482B772CCE98424C10F16A6455835E9A079D7CB39DAA388EA7B6830BF833B57BDAC69B780CA70AEE7E27D853D2D3C90A1F49C8D456BD8A43877A2F83A7034238D0E836AEC9234F6D42AAD1F84EA25647F0CFDD4BAC4795646B81CC7F2CBC7F351664C7F15EBDFDE2413348E6446BA54BD44A472C496590AC380B9AF3E925791F15F425439790852DBC4D0AB515C0A353AEBED11ACBF8593323321CCBA8E9A6681E9B5D7FD5F68FCE3326C595E2F0B60478B783DD654BC3FE5CC8296DECA77FEEA40A599DE63F3052C6EB&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8fe88143292101072aea6f43b2628e78&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>TCP传输的完整内容</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>000C000002D07B2264617461223A223330383230313441303232303231333946303133393438303433383436453043374337313542453033383830443842433935314345343831454545314143363731423731464534444341443430323230373234344132304134304338414243444534423938344533443842384545463634413435374545363235354346433131414432313443463031453646373337443034323044444543343046443531383636463643364543323336443335384535303445363037373746343942423232453531463742313132323634443432314641464638303438314531423535363636443345424234353233354646304335363534424544373331464641364237314134354536343535443438324237373243434539383432344331304631364136343535383335453941303739443743423339444141333838454137423638333042463833334235374244414336394237383043413730414545374532374438353344324433433930413146343943384434353642443841343338373741324638334137303334323338443045383336414543393233344636443432414144314638344541323536343746304346444434424143343739353634364238314343374632434243374633353136363443374631354542444644453234313333343845363434364241353442443434413437324334393635393041433338304239414633453932353739314631354634323534333937393038353244424334443041423531354330413335334145424544313141434246383539333332333332314343424138453941363638314539423544374644354636384643453333323643353935453246304236303437384237383344443635344243334645354343383239364445434137374645454134304135393944453633463330353243364542222C226D6163223A223866653838313433323932313031303732616561366634336232363238653738227D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>服务端返回包</li></ul> <table><thead><tr><th>key</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>v</td> <td>Integer</td> <td>数据协议版本号,此版本号为2</td></tr> <tr><td>code</td> <td>Integer</td> <td>请求错误码，0为成功</td></tr> <tr><td>msg</td> <td>String</td> <td>消息返回错误信息</td></tr> <tr><td>data</td> <td>jsonObject</td> <td>数据内容，通过 <code>设备公钥加密</code></td></tr> <tr><td>ran</td> <td>String</td> <td>SM4，加密KEY，有效期：24小时，需要24小时内重新登录获取新秘钥</td></tr> <tr><td>httpToken</td> <td>String</td> <td>http协议通讯时使用的token，有效期：24小时，需要24小时内重新登录获取新秘钥</td></tr> <tr><td>ts</td> <td>Long</td> <td>时间戳</td></tr> <tr><td>keyUsefulTime</td> <td>Integer</td> <td>对称秘钥以及httpToken的有效时间，单位：秒</td></tr> <tr><td>mac</td> <td>String</td> <td>加密后的data所计算的md5值</td></tr></tbody></table> <ul><li>示例</li></ul> <p>返回密文</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3081C7022100D223EBADDC629EAEA0E6BEB090A8DBFFAA05C66F78717D5317B62F519914390C0221008D7BAC3C9A8E659B3233FE01593B3E506EA6E0269DD0F1421654EDCA461942160420CC1A47F18261EDA2705D691F2A88EC4A513D08D09B392FE8DE89685A3EE9C825045DB9A6269BCC8382773A6FA601092B956F236F713364175AA4C499536B787C9D4CA66E522C5394A6264D3E92166FE47B8DD1ED905923D3E4AB02B44D41D372E9071036C40A1A4F30E702FD29E4F16D1E1FB6F2E7532FBDAC9A93BE6C5CBB&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;615e6a32de3178eb4c31812cb271f84a&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>解密后明文</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;ran&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ABCDEF0123456789&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;httpToken&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e636fe89-13d7-470a-84da-4c0514ebb727&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ts&quot;</span><span class="token operator">:</span> <span class="token number">1532179338</span><span class="token punctuation">,</span>
    <span class="token property">&quot;keyUsefulTime&quot;</span><span class="token operator">:</span> <span class="token number">86400</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a1935c8783a912ba4ca53381cc16f330&quot;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><blockquote><p>登录成功后，后续的消息传输使用SM4算法，由客户端提供加密的向量，服务端返回加密的KEY值。</p></blockquote> <hr> <h2 id="_2-自定义消息"><a href="#_2-自定义消息" aria-hidden="true" class="header-anchor">#</a> 2 自定义消息</h2> <h3 id="_2-1-mqtt"><a href="#_2-1-mqtt" aria-hidden="true" class="header-anchor">#</a> 2.1 MQTT</h3> <ul><li><p>相关配置</p></li> <li><p>mqttURL：<code>mqtt服务链接地址</code></p></li> <li><p>din：<code>设备唯一标识</code></p></li> <li><p>user：<code>mqtt登录用户名</code></p></li> <li><p>password：<code>mqtt登录密码</code></p></li> <li><p>消息订阅路径：<code>/welink/msg/receive/v1/{din}</code></p></li> <li><p>消息发布路径：<code>/welink/msg/push/v1/{din}</code></p></li> <li><p>消息体（String）</p></li></ul> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>din</td> <td>String</td> <td>设备唯一标识</td></tr> <tr><td>subDin</td> <td>String</td> <td>子设备唯一标识，非必填</td></tr> <tr><td>msgType</td> <td>String</td> <td>report：主动发送，ack：查询返回</td></tr> <tr><td>seq</td> <td>Long</td> <td>消息序号</td></tr> <tr><td>random</td> <td>Integer</td> <td>随机数</td></tr> <tr><td>timeStamp</td> <td>Long</td> <td>时间戳，单位：毫秒</td></tr> <tr><td>datapoint</td> <td>Integer</td> <td>datapoint id</td></tr> <tr><td>value</td> <td>Object</td> <td>消息自定义内容</td></tr></tbody></table> <ul><li><p>举例</p></li> <li><p>加密key：JeF8U9wHFOMfs2Y8</p></li> <li><p>向量：UISwD9fW6cFh9SNS</p></li> <li><p>明文</p></li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span> <span class="token number">1536151747890</span><span class="token punctuation">,</span>
  <span class="token property">&quot;random&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span><span class="token punctuation">,</span>
  <span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span> <span class="token number">222222</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ack&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;WL_11111111&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;自定义消息&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;seq&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>密文（以下示例用16进制展示，实际传输直接使用byte[]）</li></ul> <blockquote><div class="language- line-numbers-mode"><pre class="language-text"><code>C148FCB1CA89F4CE7D058A3AFD5220BB89D06A0EEDB9F0AD20E0CD4FA7C3D9CA4130870170C01608C16105CA9C99265A3F58EA4ED3B014E771E1FEE8419928B6548D66BAAA7854DC1FF31AC0D3F28C477D6DC137ACB1A091CDBAF026FF00074C1E3DC7EB0F6B0C51283340DD8908E8D939500B6062B65F1EB5F46B965673D82E515BAC22C32E341E2C9ED4C4E1DD8D107F49CCE9A6201F06C963518DFAF9A3C6
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></blockquote> <h3 id="_2-2-http"><a href="#_2-2-http" aria-hidden="true" class="header-anchor">#</a> 2.2 HTTP</h3> <ul><li><p>消息上报（V1）</p></li> <li><p>URL</p></li> <li><p><code>https://domain/iotmsg/httpmsg/v1/send</code></p></li> <li><p>请求方法</p></li> <li><p>POST</p></li> <li><p>Header</p></li></ul> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>Content-Type</td> <td>String</td> <td>固定为application/octet-stream</td></tr> <tr><td>din</td> <td>String</td> <td>设备唯一标识</td></tr> <tr><td>token</td> <td>String</td> <td>登录取到的临时票据</td></tr></tbody></table> <ul><li>Param</li> <li>无</li> <li>body
<code>body内容为SM4加密的密文byte[]传输，以下格式为明文格式示意</code></li> <li>格式：json</li></ul> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>din</td> <td>String</td> <td>设备唯一标识</td></tr> <tr><td>subDin</td> <td>String</td> <td>子设备唯一标识，非必填</td></tr> <tr><td>msgType</td> <td>String</td> <td>report：主动发送，ack：查询返回</td></tr> <tr><td>seq</td> <td>Long</td> <td>消息序号</td></tr> <tr><td>random</td> <td>Integer</td> <td>随机数</td></tr> <tr><td>timeStamp</td> <td>Long</td> <td>时间戳，单位：毫秒</td></tr> <tr><td>datapoint</td> <td>Integer</td> <td>datapoint id</td></tr> <tr><td>value</td> <td>Object</td> <td>消息自定义内容</td></tr></tbody></table> <ul><li>示例</li></ul> <p><code>url</code></p> <blockquote><p><code>http://api.weiling.qq.com/iotmsg/httpmsg/v1/send</code></p></blockquote> <p><code>head</code></p> <blockquote><p>din=200000000000000</p> <p>token=e636fe89-13d7-470a-84da-4c0514ebb727</p></blockquote> <ul><li>加密key：JeF8U9wHFOMfs2Y8</li> <li>向量：UISwD9fW6cFh9SNS</li> <li>明文</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2000000000000001&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;subDin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2000000000000004&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;report&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;seq&quot;</span><span class="token operator">:</span> <span class="token number">123456</span><span class="token punctuation">,</span>
  <span class="token property">&quot;random&quot;</span><span class="token operator">:</span> <span class="token number">57295</span><span class="token punctuation">,</span>
  <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token number">1543302296148</span><span class="token punctuation">,</span>
  <span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span> <span class="token number">30004</span><span class="token punctuation">,</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;welink&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>SM4加密后（实际传输以byte[]传输，示例用16进制展示）</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>BA9D148FD6ACFC4415F6B9EF12DA8E9E06C013F3CA44B2B66C0A254DD2F1CB0BE287018A006E551E254C13F3C6C0AF44F781A233CAA15F6F8B8ABF3EB2DDC2B95654D7AC2751FAB8CDBC951685A5C7ADDD44262F3D58F9EC6614AF04AD80F8B920AB028D0AC07DC0C2E75E79727023F5978567428A51C77D5BF5569993533C50A3AA44BDBB4FCF9FC148E7895562030A48A81D056CD5A7714BFE3085A72BB4319DA47DAE3136
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>返回
<code>明文返回，格式为json</code></li></ul> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>code</td> <td>Integer</td> <td>错误码，0表示成功</td></tr> <tr><td>message</td> <td>String</td> <td>执行结果消息</td></tr></tbody></table> <ul><li>错误码</li></ul> <table><thead><tr><th>code</th> <th>description</th></tr></thead> <tbody><tr><td>20002</td> <td>未登录，需要先调用登录接口</td></tr> <tr><td>20003</td> <td>SM4解密失败</td></tr> <tr><td>20004</td> <td>send内容中的din与header中的din不一致</td></tr> <tr><td>20005</td> <td>微瓴消息模块错误</td></tr> <tr><td>20000</td> <td>微瓴内部错误</td></tr></tbody></table> <ul><li><p>消息拉取</p></li> <li><p>URL</p></li> <li><p><code>https://domain/iotmsg/httpmsg/v1/pull</code></p></li> <li><p>请求方法</p></li> <li><p>GET</p></li> <li><p>Header</p></li></ul> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>din</td> <td>String</td> <td>设备唯一标识</td></tr> <tr><td>token</td> <td>String</td> <td>登录取到的临时票据</td></tr></tbody></table> <ul><li>Param</li></ul> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>seq</td> <td>String</td> <td>收到的上一条消息的seq，第一次拉取消息传0</td></tr></tbody></table> <ul><li>示例</li></ul> <p><code>url</code></p> <blockquote><p><code>http://api.weiling.qq.com/iotmsg/httpmsg/v1/pull?seq=2</code></p></blockquote> <p><code>head</code></p> <blockquote><p>din=200000000000000</p> <p>token=e636fe89-13d7-470a-84da-4c0514ebb727</p></blockquote> <h4 id="返回"><a href="#返回" aria-hidden="true" class="header-anchor">#</a> 返回</h4> <p><code>服务端等待数据超时时间为30s，即客户端需要保持至少30s的readtimeout，避免服务端收到消息推送时无法通过此链接response给客户端</code> <code>返回内容为SM4加密的密文byte[]传输，以下格式为明文格式示意</code></p> <ul><li>格式：json</li></ul> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>din</td> <td>String</td> <td>设备唯一标识</td></tr> <tr><td>subDin</td> <td>String</td> <td>子设备唯一标识，非必填属性</td></tr> <tr><td>msgType</td> <td>String</td> <td>report：主动发送，reportack：设备查询返回</td></tr> <tr><td>seq</td> <td>Long</td> <td>消息序号</td></tr> <tr><td>ackSeq</td> <td>Long</td> <td>服务端ack回复时会带上的设备上报的seq，当msgType为&quot;reportack&quot;才会有这个字段</td></tr> <tr><td>random</td> <td>Integer</td> <td>随机数</td></tr> <tr><td>timeStamp</td> <td>Long</td> <td>时间戳，单位：毫秒</td></tr> <tr><td>datapoint</td> <td>Integer</td> <td>datapoint id</td></tr> <tr><td>value</td> <td>Object</td> <td>消息自定义内容</td></tr></tbody></table> <ul><li>明文</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2000000000000001&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;reportack&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;seq&quot;</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">,</span>
  <span class="token property">&quot;ackSeq&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">&quot;random&quot;</span><span class="token operator">:</span> <span class="token number">3572295</span><span class="token punctuation">,</span>
  <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token number">1543302296148</span><span class="token punctuation">,</span>
  <span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span> <span class="token number">30001</span><span class="token punctuation">,</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;welink&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>http statusCode 状态码释义</li></ul> <table><thead><tr><th>code</th> <th>description</th></tr></thead> <tbody><tr><td>200</td> <td>为空或者为null的话表示没有消息可以拉取，有数据的话，就直接是SM4加密的密文byte[]</td></tr> <tr><td>400</td> <td>缺少参数</td></tr> <tr><td>401</td> <td>未调用登录接口，服务端无法获取到SM4对称密钥</td></tr> <tr><td>403</td> <td>http token错误</td></tr></tbody></table> <h2 id="_3-微瓴iot基础协议"><a href="#_3-微瓴iot基础协议" aria-hidden="true" class="header-anchor">#</a> 3 微瓴IOT基础协议</h2> <blockquote><p>通讯使用微瓴IOT的消息格式进行通讯</p></blockquote> <h3 id="_3-1-标准消息格式（byte-）"><a href="#_3-1-标准消息格式（byte-）" aria-hidden="true" class="header-anchor">#</a> 3.1 标准消息格式（byte[]）</h3> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>din</td> <td>String</td> <td>设备唯一标识</td></tr> <tr><td>subDin</td> <td>String</td> <td>子设备唯一标识，为空或者无此字段表示直连设备消息</td></tr> <tr><td>msgType</td> <td>String</td> <td>report：主动发送，ack：查询返回</td></tr> <tr><td>seq</td> <td>Long</td> <td>消息序号</td></tr> <tr><td>random</td> <td>Integer</td> <td>随机数</td></tr> <tr><td>timeStamp</td> <td>Long</td> <td>时间戳，单位：毫秒</td></tr> <tr><td>datapoint</td> <td>Integer</td> <td>datapoint id</td></tr> <tr><td>value</td> <td>String</td> <td>消息自定义内容</td></tr></tbody></table> <h3 id="_3-2-直连设备心跳消息（byte-）"><a href="#_3-2-直连设备心跳消息（byte-）" aria-hidden="true" class="header-anchor">#</a> 3.2 直连设备心跳消息（byte[]）</h3> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>din</td> <td>String</td> <td>设备唯一标识</td></tr> <tr><td>msgType</td> <td>String</td> <td>report：主动发送，ack：查询返回，固定report</td></tr> <tr><td>seq</td> <td>Long</td> <td>消息序号</td></tr> <tr><td>random</td> <td>Integer</td> <td>随机数</td></tr> <tr><td>timeStamp</td> <td>Long</td> <td>时间戳，单位：毫秒</td></tr> <tr><td>datapoint</td> <td>Integer</td> <td>datapoint id，固定心跳dp：30001</td></tr> <tr><td>value</td> <td>String</td> <td>消息自定义内容，固定为welink</td></tr></tbody></table> <ul><li><p>举例</p></li> <li><p>加密key：JeF8U9wHFOMfs2Y8</p></li> <li><p>向量：UISwD9fW6cFh9SNS</p></li> <li><p>明文</p></li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span> <span class="token number">1536151747890</span><span class="token punctuation">,</span>
  <span class="token property">&quot;random&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span><span class="token punctuation">,</span>
  <span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span> <span class="token number">30001</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;report&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11111111&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;welink&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;seq&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>密文</li></ul> <blockquote><div class="language- line-numbers-mode"><pre class="language-text"><code>C148FCB1CA89F4CE7D058A3AFD5220BB89D06A0EEDB9F0AD20E0CD4FA7C3D9CA4130870170C01608C16105CA9C99265A2F42E94FE49A675E857BFDC303304715A5C393E1470B975E076C81E4F34F7E3A4DB9BD9D4522BD83042CACBF3039DFFA9370302B411B160DEB0BFDA3378C51DBD54DAB3FE614ABAB1A76EA3A80F6B9603638CCB14954123008460AE0A1E78D7A
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></blockquote> <h3 id="_3-3-网关上报子设备注册消息（byte-）"><a href="#_3-3-网关上报子设备注册消息（byte-）" aria-hidden="true" class="header-anchor">#</a> 3.3 网关上报子设备注册消息（byte[]）</h3> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>din</td> <td>String</td> <td>网关设备唯一标识</td></tr> <tr><td>msgType</td> <td>String</td> <td>report：主动发送，ack：查询返回，固定report</td></tr> <tr><td>seq</td> <td>Long</td> <td>消息序号</td></tr> <tr><td>random</td> <td>Integer</td> <td>随机数</td></tr> <tr><td>timeStamp</td> <td>Long</td> <td>时间戳，单位：毫秒</td></tr> <tr><td>datapoint</td> <td>Integer</td> <td>datapoint id，通电后上报dp：30010</td></tr> <tr><td>value</td> <td>String</td> <td>消息自定义内容</td></tr> <tr><td>pid</td> <td>String</td> <td>产品id</td></tr> <tr><td>sn</td> <td>String</td> <td>设备sn</td></tr> <tr><td>page</td> <td>Integer</td> <td>第几页</td></tr> <tr><td>pageSize</td> <td>Integer</td> <td>一页多少记录,最多100</td></tr> <tr><td>total</td> <td>Integer</td> <td>总记录数</td></tr></tbody></table> <ul><li><p>举例</p></li> <li><p>加密key：JeF8U9wHFOMfs2Y8</p></li> <li><p>向量：UISwD9fW6cFh9SNS</p></li> <li><p>明文</p></li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span> <span class="token number">1536151747890</span><span class="token punctuation">,</span>
    <span class="token property">&quot;random&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span><span class="token punctuation">,</span>
    <span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span> <span class="token number">30010</span><span class="token punctuation">,</span>
    <span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;report&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11111111&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;page&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;pageSize&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">&quot;deviceList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;pid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1700005449&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;sn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pppanchong_12345ddd1016&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;pid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1700002550&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;sn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sn201800001&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;seq&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li>密文</li></ul> <blockquote><div class="language- line-numbers-mode"><pre class="language-text"><code>C148FCB1CA89F4CE7D058A3AFD5220BB89D06A0EEDB9F0AD20E0CD4FA7C3D9CA4130870170C01608C16105CA9C99265A2F42E94FE49A675E857BFDC303304715CA00795A315FE26B69D35FACD1524E1C5532A7F23BD154BB00D3C2C0ABAE66739546806AFF7635BC4084929E3B1F5C9251E96C0935F72C92A717E0C600F8D3F5D4ACEB42FC4E7D6A42CB29C4E36F3B8504CDBE80F042111C08A4C993359451F105C355FCB9CC48C120A2279B78F169089160C53ECB793B4B3402084F63294155FD568774CBF4195A0A7B614E5C03F42FA6180AC3AAF903AD350B4A469D6C90967C537002C7AD7B1ED7B5DBA646D6CE502DF44FFC15AFE665DF73D9D4D0EC491D743BE939C3D29F36476787EEBF232485
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></blockquote> <h3 id="_3-4-子设备列表接收（byte-）"><a href="#_3-4-子设备列表接收（byte-）" aria-hidden="true" class="header-anchor">#</a> 3.4 子设备列表接收（byte[]）</h3> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>din</td> <td>String</td> <td>设备唯一标识</td></tr> <tr><td>msgType</td> <td>String</td> <td>report：主动发送，ack：查询返回，固定report</td></tr> <tr><td>seq</td> <td>Long</td> <td>消息序号</td></tr> <tr><td>random</td> <td>Integer</td> <td>随机数</td></tr> <tr><td>timeStamp</td> <td>Long</td> <td>时间戳，单位：毫秒</td></tr> <tr><td>datapoint</td> <td>Integer</td> <td>datapoint id，固定datapoint：30006</td></tr> <tr><td>value</td> <td>String</td> <td>消息自定义内容，jsonArray格式</td></tr> <tr><td>din</td> <td>String</td> <td>子设备din</td></tr> <tr><td>sn</td> <td>String</td> <td>子设备唯一序列号</td></tr> <tr><td>pid</td> <td>Integer</td> <td>子设备的product id</td></tr></tbody></table> <ul><li><p>举例</p></li> <li><p>加密key：JeF8U9wHFOMfs2Y8</p></li> <li><p>向量：UISwD9fW6cFh9SNS</p></li> <li><p>明文</p></li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span> <span class="token number">1536151747890</span><span class="token punctuation">,</span>
  <span class="token property">&quot;random&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span><span class="token punctuation">,</span>
  <span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span> <span class="token number">30006</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;report&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11111111&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[{\&quot;din\&quot;:\&quot;200200000000000126\&quot;,\&quot;pid\&quot;:1700005449,\&quot;sn\&quot;:\&quot;pppanchong_12345ddd1016\&quot;},{\&quot;din\&quot;:\&quot;200200000000000127\&quot;,\&quot;pid\&quot;:1700002550,\&quot;sn\&quot;:\&quot;sn201800001\&quot;}]&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;seq&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>密文</li></ul> <blockquote><div class="language- line-numbers-mode"><pre class="language-text"><code>C148FCB1CA89F4CE7D058A3AFD5220BB89D06A0EEDB9F0AD20E0CD4FA7C3D9CA4130870170C01608C16105CA9C99265A2F42E94FE49A675E857BFDC303304715CA00795A315FE26B69D35FACD1524E1C5532A7F23BD154BB00D3C2C0ABAE66739546806AFF7635BC4084929E3B1F5C9251E96C0935F72C92A717E0C600F8D3F5D4ACEB42FC4E7D6A42CB29C4E36F3B8504CDBE80F042111C08A4C993359451F105C355FCB9CC48C120A2279B78F169089160C53ECB793B4B3402084F63294155FD568774CBF4195A0A7B614E5C03F42FA6180AC3AAF903AD350B4A469D6C90967C537002C7AD7B1ED7B5DBA646D6CE502DF44FFC15AFE665DF73D9D4D0EC491D743BE939C3D29F36476787EEBF232485
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></blockquote> <h3 id="_3-5-获取云端子设备列表信息（byte-）"><a href="#_3-5-获取云端子设备列表信息（byte-）" aria-hidden="true" class="header-anchor">#</a> 3.5 获取云端子设备列表信息（byte[]）</h3> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>din</td> <td>String</td> <td>设备唯一标识</td></tr> <tr><td>msgType</td> <td>String</td> <td>report：主动发送，ack：查询返回，固定report</td></tr> <tr><td>seq</td> <td>Long</td> <td>消息序号</td></tr> <tr><td>random</td> <td>Integer</td> <td>随机数</td></tr> <tr><td>timeStamp</td> <td>Long</td> <td>时间戳，单位：毫秒</td></tr> <tr><td>datapoint</td> <td>Integer</td> <td>datapoint id，固定datapoint：30013</td></tr> <tr><td>value</td> <td>String</td> <td>消息自定义内容，jsonArray格式</td></tr> <tr><td>din</td> <td>String</td> <td>子设备din</td></tr> <tr><td>sn</td> <td>String</td> <td>子设备唯一序列号</td></tr> <tr><td>pid</td> <td>Integer</td> <td>子设备的product id</td></tr></tbody></table> <ul><li><p>举例</p></li> <li><p>加密key：JeF8U9wHFOMfs2Y8</p></li> <li><p>向量：UISwD9fW6cFh9SNS</p></li> <li><p>明文</p></li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span> <span class="token number">1536151747890</span><span class="token punctuation">,</span>
  <span class="token property">&quot;random&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span><span class="token punctuation">,</span>
  <span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span> <span class="token number">30013</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;report&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11111111&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;page&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;pageSize&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token property">&quot;deviceList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;pid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1700005449&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;sn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pppanchong_12345ddd1016&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;pid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1700002550&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;sn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sn201800001&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;seq&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li>密文</li></ul> <blockquote><div class="language- line-numbers-mode"><pre class="language-text"><code>C148FCB1CA89F4CE7D058A3AFD5220BB89D06A0EEDB9F0AD20E0CD4FA7C3D9CA4130870170C01608C16105CA9C99265A2F42E94FE49A675E857BFDC303304715CA00795A315FE26B69D35FACD1524E1C5532A7F23BD154BB00D3C2C0ABAE66739546806AFF7635BC4084929E3B1F5C9251E96C0935F72C92A717E0C600F8D3F5D4ACEB42FC4E7D6A42CB29C4E36F3B8504CDBE80F042111C08A4C993359451F105C355FCB9CC48C120A2279B78F169089160C53ECB793B4B3402084F63294155FD568774CBF4195A0A7B614E5C03F42FA6180AC3AAF903AD350B4A469D6C90967C537002C7AD7B1ED7B5DBA646D6CE502DF44FFC15AFE665DF73D9D4D0EC491D743BE939C3D29F36476787EEBF232485
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></blockquote> <h3 id="_3-6-子设备状态列表上报（byte-）"><a href="#_3-6-子设备状态列表上报（byte-）" aria-hidden="true" class="header-anchor">#</a> 3.6 子设备状态列表上报（byte[]）</h3> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>din</td> <td>String</td> <td>设备唯一标识</td></tr> <tr><td>msgType</td> <td>String</td> <td>report：主动发送，ack：查询返回，固定report</td></tr> <tr><td>seq</td> <td>Long</td> <td>消息序号</td></tr> <tr><td>random</td> <td>Integer</td> <td>随机数</td></tr> <tr><td>timeStamp</td> <td>Long</td> <td>时间戳，单位：毫秒</td></tr> <tr><td>datapoint</td> <td>Integer</td> <td>datapoint id，固定datapoint：30002</td></tr> <tr><td>value</td> <td>String</td> <td>消息自定义内容</td></tr> <tr><td>page</td> <td>Integer</td> <td>当前页码</td></tr> <tr><td>pagesize</td> <td>Integer</td> <td>总页码</td></tr> <tr><td>total</td> <td>Integer</td> <td>设备总数</td></tr> <tr><td>deviceList</td> <td>jsonArray</td> <td>子设备状态列表</td></tr> <tr><td>din</td> <td>String</td> <td>子设备din</td></tr> <tr><td>status</td> <td>String</td> <td>子设备状态</td></tr></tbody></table> <ul><li><p>举例</p></li> <li><p>加密key：JeF8U9wHFOMfs2Y8</p></li> <li><p>向量：UISwD9fW6cFh9SNS</p></li> <li><p>明文</p></li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span> <span class="token number">1536151747890</span><span class="token punctuation">,</span>
  <span class="token property">&quot;random&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span><span class="token punctuation">,</span>
  <span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span> <span class="token number">30002</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;report&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11111111&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;page&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;pagesize&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">&quot;deviceList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;200200000000000010&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;offline&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;200200000000000011&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;online&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;seq&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li>密文</li></ul> <blockquote><div class="language- line-numbers-mode"><pre class="language-text"><code>C148FCB1CA89F4CE7D058A3AFD5220BB89D06A0EEDB9F0AD20E0CD4FA7C3D9CA4130870170C01608C16105CA9C99265A2F42E94FE49A675E857BFDC303304715CA00795A315FE26B69D35FACD1524E1C5532A7F23BD154BB00D3C2C0ABAE66739546806AFF7635BC4084929E3B1F5C9251E96C0935F72C92A717E0C600F8D3F5D4ACEB42FC4E7D6A42CB29C4E36F3B8504CDBE80F042111C08A4C993359451F105C355FCB9CC48C120A2279B78F169089160C53ECB793B4B3402084F63294155FD568774CBF4195A0A7B614E5C03F42FA6180AC3AAF903AD350B4A469D6C90967C537002C7AD7B1ED7B5DBA646D6CE502DF44FFC15AFE665DF73D9D4D0EC491D743BE939C3D29F36476787EEBF232485
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></blockquote> <h3 id="_3-7-设备下载文件"><a href="#_3-7-设备下载文件" aria-hidden="true" class="header-anchor">#</a> 3.7 设备下载文件</h3> <ul><li><p>设备收到的消息格式</p></li> <li><p>dataponit id:30003</p></li></ul> <blockquote><p><strong>下面表格表示 value格式</strong></p></blockquote> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>fileId</td> <td>Stirng</td> <td>文件唯一标识</td></tr> <tr><td>fileName</td> <td>Stirng</td> <td>文件名</td></tr> <tr><td>length</td> <td>Integer</td> <td>上传文件大小</td></tr> <tr><td>hash</td> <td>String</td> <td>文件内容做SHA-256的hash，格式为16进制</td></tr> <tr><td>url</td> <td>String</td> <td>文件下载地址</td></tr> <tr><td>data</td> <td>String</td> <td>自定义透传消息</td></tr></tbody></table> <blockquote><p><strong>实例</strong></p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span><span class="token number">1536151747890</span><span class="token punctuation">,</span><span class="token property">&quot;random&quot;</span><span class="token operator">:</span><span class="token number">1149701758</span><span class="token punctuation">,</span><span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span><span class="token number">30003</span><span class="token punctuation">,</span><span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span><span class="token string">&quot;report&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;din&quot;</span><span class="token operator">:</span><span class="token string">&quot;11111111&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;fileId&quot;</span><span class="token operator">:</span><span class="token string">&quot;3364aef0-ca60-450a-b694-9dedae930b05&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;fileName&quot;</span><span class="token operator">:</span><span class="token string">&quot;testupload.jpg&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;length&quot;</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token property">&quot;hash&quot;</span><span class="token operator">:</span><span class="token string">&quot;73b48297c6ebac071ac66a03a8dabccbc9d0377c9b0b525d31e8cd14f5892713&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;url&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://10.56.63.195:8504/file/upload/200200000000000008/2018-12-21/testupload?save_type=bigfiletodevice&amp;wl_auth_sign=06f8789de2741cb7a29e40fa847a7e9cb2adcdc1fd27f9241515aa233566fe1b&amp;wl_expire_time=1545406322095&amp;wl_file_length=25&amp;wl_file_sign=73b48297c6ebac071ac66a03a8dabccbc9d0377c9b0b525d31e8cd14f5892713&amp;write_disk=d5&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;data&quot;</span><span class="token operator">:</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seq&quot;</span><span class="token operator">:</span><span class="token number">1149701758</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-8-设备上传文件"><a href="#_3-8-设备上传文件" aria-hidden="true" class="header-anchor">#</a> 3.8 设备上传文件</h3> <p>设备上传文件分成三个步骤</p> <ul><li><p>设备请求上传</p></li> <li><p>微瓴异步回复设备上传url</p></li> <li><p>设备完成上传，上报给微瓴</p></li> <li><p>设备请求上传格式</p></li> <li><p>dataponit id:<code>30004</code></p> <p><strong>下面表格表示 value格式</strong></p></li></ul> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>fileName</td> <td>Stirng</td> <td>文件名</td></tr> <tr><td>length</td> <td>Integer</td> <td>上传文件大小</td></tr> <tr><td>hash</td> <td>String</td> <td>文件内容做SHA-256的hash，格式为16进制</td></tr> <tr><td>data</td> <td>String</td> <td>自定义透传消息</td></tr></tbody></table> <blockquote><p><strong>实例</strong></p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span><span class="token number">1536151747890</span><span class="token punctuation">,</span><span class="token property">&quot;random&quot;</span><span class="token operator">:</span><span class="token number">1149701758</span><span class="token punctuation">,</span><span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span><span class="token number">30004</span><span class="token punctuation">,</span><span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span><span class="token string">&quot;report&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;din&quot;</span><span class="token operator">:</span><span class="token string">&quot;11111111&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;fileName&quot;</span><span class="token operator">:</span><span class="token string">&quot;testupload.jpg&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;data&quot;</span><span class="token operator">:</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;length&quot;</span><span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token property">&quot;hash&quot;</span><span class="token operator">:</span><span class="token string">&quot;73b48297c6ebac071ac66a03a8dabccbc9d0377c9b0b525d31e8cd14f5892713&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seq&quot;</span><span class="token operator">:</span><span class="token number">1149701758</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>微瓴异步回复设备上传url</li></ul> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>fileId</td> <td>Stirng</td> <td>文件唯一标识</td></tr> <tr><td>url</td> <td>String</td> <td>文件上传url</td></tr></tbody></table> <blockquote><p><strong>实例</strong></p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span><span class="token number">1536151747890</span><span class="token punctuation">,</span><span class="token property">&quot;random&quot;</span><span class="token operator">:</span><span class="token number">1149701758</span><span class="token punctuation">,</span><span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span><span class="token number">30004</span><span class="token punctuation">,</span><span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span><span class="token string">&quot;reportack&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;ackSeq&quot;</span><span class="token operator">:</span><span class="token number">1149701758</span><span class="token punctuation">,</span><span class="token property">&quot;din&quot;</span><span class="token operator">:</span><span class="token string">&quot;11111111&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;{\&quot;sign\&quot;:\&quot;\&quot;,\&quot;url\&quot;:\&quot;http://10.56.63.195:8504/file/upload/200200000000000008/2018-12-21/testupload?save_type=bigfiletodevice&amp;wl_auth_sign=06f8789de2741cb7a29e40fa847a7e9cb2adcdc1fd27f9241515aa233566fe1b&amp;wl_expire_time=1545406322095&amp;wl_file_length=25&amp;wl_file_sign=73b48297c6ebac071ac66a03a8dabccbc9d0377c9b0b525d31e8cd14f5892713&amp;write_disk=d5\&quot;,\&quot;fileId\&quot;:\&quot;3364aef0-ca60-450a-b694-9dedae930b05\&quot;}&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;seq&quot;</span><span class="token operator">:</span><span class="token number">1149701759</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>设备发送文件上传结果</li></ul> <blockquote><p><strong>参数格式</strong></p></blockquote> <p>datapoint:30005</p> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>fileId</td> <td>Stirng</td> <td>文件唯一标识</td></tr> <tr><td>result</td> <td>String</td> <td>固定参数，&quot;success&quot;、&quot;fail&quot;</td></tr> <tr><td>data</td> <td>String</td> <td>自定义透传消息</td></tr></tbody></table> <blockquote><p><strong>实例</strong></p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span><span class="token number">1536151747890</span><span class="token punctuation">,</span><span class="token property">&quot;random&quot;</span><span class="token operator">:</span><span class="token number">1149701758</span><span class="token punctuation">,</span><span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span><span class="token number">30005</span><span class="token punctuation">,</span><span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span><span class="token string">&quot;report&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;din&quot;</span><span class="token operator">:</span><span class="token string">&quot;11111111&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;fileId&quot;</span><span class="token operator">:</span><span class="token string">&quot;3364aef0-ca60-450a-b694-9dedae930b05&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;result&quot;</span><span class="token operator">:</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;data&quot;</span><span class="token operator">:</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;seq&quot;</span><span class="token operator">:</span><span class="token number">1149701760</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-9-网关请求子设备列表"><a href="#_3-9-网关请求子设备列表" aria-hidden="true" class="header-anchor">#</a> 3.9 网关请求子设备列表</h3> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>din</td> <td>String</td> <td>设备唯一标识</td></tr> <tr><td>msgType</td> <td>String</td> <td>report：主动发送，ack：查询返回，固定report</td></tr> <tr><td>seq</td> <td>Long</td> <td>消息序号</td></tr> <tr><td>random</td> <td>Integer</td> <td>随机数</td></tr> <tr><td>timeStamp</td> <td>Long</td> <td>时间戳，单位：毫秒</td></tr> <tr><td>datapoint</td> <td>Integer</td> <td>datapoint id，固定心跳dp：30007</td></tr> <tr><td>value</td> <td>String</td> <td>消息自定义内容，固定为welink</td></tr></tbody></table> <ul><li><p>举例</p></li> <li><p>加密key：JeF8U9wHFOMfs2Y8</p></li> <li><p>向量：UISwD9fW6cFh9SNS</p></li> <li><p>明文</p></li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span> <span class="token number">1536151747890</span><span class="token punctuation">,</span>
  <span class="token property">&quot;random&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span><span class="token punctuation">,</span>
  <span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span> <span class="token number">30007</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;report&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11111111&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;welink&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;seq&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>密文</li></ul> <blockquote><div class="language- line-numbers-mode"><pre class="language-text"><code>C148FCB1CA89F4CE7D058A3AFD5220BB89D06A0EEDB9F0AD20E0CD4FA7C3D9CA4130870170C01608C16105CA9C99265A2F42E94FE49A675E857BFDC303304715A5C393E1470B975E076C81E4F34F7E3A4DB9BD9D4522BD83042CACBF3039DFFA9370302B411B160DEB0BFDA3378C51DBD54DAB3FE614ABAB1A76EA3A80F6B9603638CCB14954123008460AE0A1E78D7A
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></blockquote> <h3 id="_3-10-ota更新"><a href="#_3-10-ota更新" aria-hidden="true" class="header-anchor">#</a> 3.10 OTA更新</h3> <ul><li><p>dataponit id:<code>30011</code></p></li> <li><p>value内字段示意</p></li></ul> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>fileId</td> <td>Stirng</td> <td>文件唯一标识</td></tr> <tr><td>fileName</td> <td>Stirng</td> <td>文件名</td></tr> <tr><td>length</td> <td>Integer</td> <td>上传文件大小,单位：byte</td></tr> <tr><td>hash</td> <td>String</td> <td>文件内容做SHA-256的hash，格式为16进制</td></tr> <tr><td>url</td> <td>String</td> <td>文件下载地址</td></tr> <tr><td>data</td> <td>String</td> <td>自定义消息</td></tr> <tr><td>ota_id</td> <td>String</td> <td>ota升级包的id值</td></tr> <tr><td>cmd</td> <td>String</td> <td>升级指令，full：全量更新包 ，increment：增量更新包</td></tr></tbody></table> <ul><li>示例</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span> <span class="token number">1536151747890</span><span class="token punctuation">,</span>
  <span class="token property">&quot;random&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span><span class="token punctuation">,</span>
  <span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span> <span class="token number">222222</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;report&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;WL_11111111&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fileId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UUID&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;fileName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;WELINK-TH82S1-V1.0.0.0-build-20180509173508_test.bin&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;length&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
    <span class="token property">&quot;hash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1234567890ABCDEF&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://mvs-30035.sz.gfp.tencent-cloud.com//emulated/0/tencent/device/accesslog/1551345059794?sign=q-sign-algorithms6q-akDJwxbdHXcgrqZyWxNOcqdDnNq-sign-tim1551345059&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{\&quot;ota_id\&quot;:\&quot;12\&quot;,\&quot;cmd\&quot;:\&quot;full\&quot;}&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;seq&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_3-11-设备升级成功后上报升级结果"><a href="#_3-11-设备升级成功后上报升级结果" aria-hidden="true" class="header-anchor">#</a> 3.11 设备升级成功后上报升级结果</h3> <ul><li>请求格式</li> <li>dataponit id:<code>30012</code></li> <li>字段示意</li></ul> <table><thead><tr><th>key</th> <th>value</th> <th>description</th></tr></thead> <tbody><tr><td>fileId</td> <td>Stirng</td> <td>文件唯一标识</td></tr> <tr><td>fileName</td> <td>Stirng</td> <td>文件名</td></tr> <tr><td>length</td> <td>Integer</td> <td>下载的文件大小,单位：byte</td></tr> <tr><td>hash</td> <td>String</td> <td>文件内容做SHA-256的hash，格式为16进制</td></tr> <tr><td>firmwareVersion</td> <td>String</td> <td>当前固件版本号</td></tr> <tr><td>ota_id</td> <td>String</td> <td>当前ota升级包的id值，如果升级失败则保持之前的ota_id值</td></tr> <tr><td>result</td> <td>String</td> <td>升级结果，success：成功 ，fail：失败</td></tr></tbody></table> <ul><li>示例</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;timeStamp&quot;</span><span class="token operator">:</span> <span class="token number">1536151769890</span><span class="token punctuation">,</span>
  <span class="token property">&quot;random&quot;</span><span class="token operator">:</span> <span class="token number">3390683214</span><span class="token punctuation">,</span>
  <span class="token property">&quot;datapoint&quot;</span><span class="token operator">:</span> <span class="token number">30012</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msgType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ack&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;din&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1234567890&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fileId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UUID&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;fileName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;WELINK-TH82S1-V1.0.0.0-build-20180509173508_test.bin&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;length&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
    <span class="token property">&quot;hash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1234567890ABCDEF&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;firmwareVersion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;WELINK-TH82S1-V1.0.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ota_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;12&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;seq&quot;</span><span class="token operator">:</span> <span class="token number">1149701758</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Guide.html" class="prev">接入指南</a></span> <span class="next"><a href="/Application_of_API.html">应用API</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.db21f27a.js" defer></script><script src="/assets/js/2.82b08f5a.js" defer></script><script src="/assets/js/9.4b85b1ac.js" defer></script>
  </body>
</html>
